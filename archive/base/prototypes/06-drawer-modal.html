<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>06 — Drawer & Modal | Kyle DS Prototypes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primitive-neutral-50:  oklch(0.978 0.005 90);
      --primitive-neutral-100: oklch(0.958 0.006 90);
      --primitive-neutral-200: oklch(0.905 0.007 90);
      --primitive-neutral-300: oklch(0.855 0.008 90);
      --primitive-neutral-400: oklch(0.755 0.010 90);
      --primitive-neutral-600: oklch(0.490 0.010 90);
      --primitive-neutral-950: oklch(0.135 0.008 90);
      --primitive-blue-500: oklch(0.550 0.220 260);
      --primitive-blue-600: oklch(0.480 0.220 260);
      --bg-page: var(--primitive-neutral-50);
      --bg-surface: oklch(0.995 0.002 90);
      --bg-muted: var(--primitive-neutral-100);
      --text-primary: var(--primitive-neutral-950);
      --text-secondary: var(--primitive-neutral-600);
      --text-muted: var(--primitive-neutral-400);
      --border-default: var(--primitive-neutral-200);
      --border-strong: var(--primitive-neutral-300);
      --accent-blue: var(--primitive-blue-500);
      --accent-blue-hover: var(--primitive-blue-600);
      --accent-blue-subtle: oklch(0.920 0.045 260);
      --text-on-accent: oklch(0.995 0.002 90);
      --space-1: 4px; --space-2: 8px; --space-3: 12px;
      --space-4: 16px; --space-6: 24px; --space-8: 32px;
      --space-12: 48px;
      --radius-sm: 6px; --radius-md: 10px; --radius-lg: 12px; --radius-full: 9999px;
      --shadow-md: 0 4px 24px oklch(0 0 0 / 0.08);
      --backdrop-color: oklch(0 0 0 / 0.3);
    }
    [data-theme="dark"] {
      --bg-page: oklch(0.135 0.010 90);
      --bg-surface: oklch(0.160 0.012 90);
      --bg-muted: oklch(0.205 0.012 90);
      --text-primary: oklch(0.95 0.003 90);
      --text-secondary: oklch(0.65 0.008 90);
      --text-muted: oklch(0.45 0.006 90);
      --border-default: oklch(0.260 0.012 90);
      --border-strong: oklch(0.330 0.012 90);
      --accent-blue: oklch(0.670 0.200 260);
      --accent-blue-hover: oklch(0.720 0.190 260);
      --accent-blue-subtle: oklch(0.250 0.060 260);
      --text-on-accent: oklch(0.995 0.002 90);
      --shadow-md: 0 4px 24px oklch(0 0 0 / 0.3);
      --backdrop-color: oklch(0 0 0 / 0.6);
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      font-feature-settings: "cv02", "cv03", "cv04", "cv11";
      background: var(--bg-page); color: var(--text-primary);
      line-height: 1.6; -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* Page wrapper — gets scaled when drawer/modal opens */
    .page-wrapper {
      min-height: 100vh; transition: transform 360ms cubic-bezier(0.2, 0, 0, 1), border-radius 360ms cubic-bezier(0.2, 0, 0, 1);
      transform-origin: top center; background: var(--bg-page);
    }
    .page-wrapper.scaled { transform: scale(0.97) translateY(12px); border-radius: var(--radius-lg); overflow: hidden; }

    .page { max-width: 560px; margin: 0 auto; padding: var(--space-12) var(--space-6); }
    .page-header { margin-bottom: var(--space-8); display: flex; align-items: center; justify-content: space-between; }
    .page-title { font-size: 1.75rem; font-weight: 650; letter-spacing: -0.02em; line-height: 1.2; }

    .btn {
      display: inline-flex; align-items: center; gap: var(--space-2);
      padding: var(--space-2) var(--space-4); font-family: inherit; font-size: 0.875rem;
      font-weight: 500; border-radius: var(--radius-sm); border: 1px solid transparent; cursor: pointer;
    }
    .btn-primary { background: var(--accent-blue); color: var(--text-on-accent); }
    .btn-primary:hover { background: var(--accent-blue-hover); }
    .btn:focus-visible { outline: 2px solid var(--accent-blue); outline-offset: 2px; }
    .btn:active { transform: scale(0.97); }
    .btn-ghost { background: transparent; color: var(--text-secondary); border: none; padding: var(--space-2); }
    .btn-ghost:hover { background: var(--bg-muted); color: var(--text-primary); }

    /* Task list */
    .task-list { display: flex; flex-direction: column; gap: var(--space-2); }
    .task-card {
      display: flex; align-items: center; gap: var(--space-4);
      padding: var(--space-4) var(--space-6); background: var(--bg-surface);
      border: 1px solid var(--border-default); border-radius: var(--radius-md);
      cursor: pointer; transition: border-color 160ms ease-out;
    }
    .task-card:hover { border-color: var(--border-strong); }
    .task-card:focus-visible { outline: 2px solid var(--accent-blue); outline-offset: 2px; }
    .task-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .task-dot.high { background: var(--accent-blue); }
    .task-dot.medium { background: oklch(0.75 0.18 85); }
    .task-dot.low { background: var(--text-muted); }
    .task-info { flex: 1; }
    .task-name { font-weight: 550; font-size: 0.9375rem; }
    .task-due { font-size: 0.8125rem; color: var(--text-muted); }

    /* Backdrop */
    .backdrop {
      position: fixed; inset: 0; background: var(--backdrop-color);
      z-index: 50; opacity: 0; pointer-events: none;
      transition: opacity 240ms ease-out;
    }
    .backdrop.visible { opacity: 1; pointer-events: auto; }

    /* Bottom Drawer */
    .drawer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--bg-surface); border-top: 1px solid var(--border-default);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      padding: var(--space-6); padding-top: var(--space-4);
      z-index: 60; transform: translateY(100%);
      max-height: 80vh; overflow-y: auto;
      box-shadow: 0 -8px 40px oklch(0 0 0 / 0.1);
    }
    .drawer-handle {
      width: 36px; height: 4px; background: var(--border-strong);
      border-radius: var(--radius-full); margin: 0 auto var(--space-4);
      cursor: grab;
    }
    .drawer-title { font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-6); }
    .form-group { margin-bottom: var(--space-4); }
    .form-label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: var(--space-1); }
    .form-input, .form-textarea, .form-select {
      width: 100%; padding: var(--space-2) var(--space-3);
      font-family: inherit; font-size: 0.9375rem; background: var(--bg-page);
      border: 1px solid var(--border-default); border-radius: var(--radius-sm);
      color: var(--text-primary); outline: none;
    }
    .form-input:focus, .form-textarea:focus, .form-select:focus { border-color: var(--accent-blue); }
    .form-textarea { resize: vertical; min-height: 80px; }

    /* Center Modal */
    .modal-wrapper {
      position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
      z-index: 60; pointer-events: none;
    }
    .modal {
      background: var(--bg-surface); border: 1px solid var(--border-default);
      border-radius: var(--radius-md); padding: var(--space-6);
      max-width: 420px; width: calc(100% - 32px); box-shadow: var(--shadow-md);
      opacity: 0; transform: scale(0.96);
      pointer-events: auto;
    }
    .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-4); }
    .modal-title { font-size: 1.125rem; font-weight: 600; }
    .modal-body { font-size: 0.9375rem; color: var(--text-secondary); line-height: 1.6; }
    .modal-body p { margin-bottom: var(--space-3); }
    .modal-meta { font-size: 0.8125rem; color: var(--text-muted); margin-top: var(--space-4); display: flex; gap: var(--space-4); }
    .modal-actions { margin-top: var(--space-6); display: flex; gap: var(--space-3); justify-content: flex-end; }

    /* Legend */
    .legend { margin-top: var(--space-12); padding: var(--space-6); background: var(--bg-muted); border-radius: var(--radius-md); font-size: 0.8125rem; color: var(--text-secondary); }
    .legend h3 { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: var(--space-3); }
    .legend-item { display: flex; gap: var(--space-3); padding: var(--space-2) 0; border-bottom: 1px solid var(--border-default); }
    .legend-item:last-child { border-bottom: none; }
    .legend-label { font-weight: 500; color: var(--text-primary); white-space: nowrap; }

    .theme-toggle { position: fixed; top: var(--space-4); right: var(--space-4); z-index: 100; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-full); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); }
    .theme-toggle:hover { border-color: var(--border-strong); color: var(--text-primary); }
    .theme-toggle .icon-sun, [data-theme="dark"] .theme-toggle .icon-moon { display: none; }
    [data-theme="dark"] .theme-toggle .icon-sun { display: block; }
    .theme-toggle .icon-moon { display: block; }
  </style>
</head>
<body>
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
    <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
    <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
  </button>

  <div class="backdrop" id="backdrop"></div>

  <div class="page-wrapper" id="page-wrapper">
    <div class="page">
      <header class="page-header">
        <h1 class="page-title">Tasks</h1>
        <button class="btn btn-primary" id="btn-add-task">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Add task
        </button>
      </header>

      <div class="task-list">
        <div class="task-card" tabindex="0" data-task="0">
          <span class="task-dot high"></span>
          <div class="task-info"><div class="task-name">Review Q4 analytics report</div><div class="task-due">Due tomorrow</div></div>
        </div>
        <div class="task-card" tabindex="0" data-task="1">
          <span class="task-dot medium"></span>
          <div class="task-info"><div class="task-name">Update design system tokens</div><div class="task-due">Due Friday</div></div>
        </div>
        <div class="task-card" tabindex="0" data-task="2">
          <span class="task-dot low"></span>
          <div class="task-info"><div class="task-name">Write API documentation</div><div class="task-due">Due next week</div></div>
        </div>
        <div class="task-card" tabindex="0" data-task="3">
          <span class="task-dot medium"></span>
          <div class="task-info"><div class="task-name">Prepare quarterly presentation</div><div class="task-due">Due in 2 weeks</div></div>
        </div>
        <div class="task-card" tabindex="0" data-task="4">
          <span class="task-dot high"></span>
          <div class="task-info"><div class="task-name">Migrate database schema</div><div class="task-due">No deadline</div></div>
        </div>
      </div>

      <div class="legend">
        <h3>Animation Reference</h3>
        <div class="legend-item"><span class="legend-label">Drawer entry</span><span>translateY: 100%→0%, spring (400/35 standard). iOS-like overdamped feel.</span></div>
        <div class="legend-item"><span class="legend-label">Page scale</span><span>scale: 1→0.97, translateY: 0→12px, borderRadius: 0→12px, 360ms standard easing</span></div>
        <div class="legend-item"><span class="legend-label">Modal entry</span><span>scale: 0.96→1, opacity: 0→1, spring (500/30 snappy)</span></div>
        <div class="legend-item"><span class="legend-label">Backdrop</span><span>opacity: 0→1, 240ms ease-out. oklch black with alpha.</span></div>
        <div class="legend-item"><span class="legend-label">Drag dismiss</span><span>Pointer tracking, 30% threshold. Below threshold: spring back (500/30).</span></div>
      </div>
    </div>
  </div>

  <!-- Bottom Drawer -->
  <div class="drawer" id="drawer">
    <div class="drawer-handle" id="drawer-handle"></div>
    <h2 class="drawer-title">New Task</h2>
    <div class="form-group">
      <label class="form-label" for="task-title">Title</label>
      <input class="form-input" type="text" id="task-title" placeholder="What needs to be done?">
    </div>
    <div class="form-group">
      <label class="form-label" for="task-desc">Description</label>
      <textarea class="form-textarea" id="task-desc" placeholder="Add details..."></textarea>
    </div>
    <div class="form-group">
      <label class="form-label" for="task-priority">Priority</label>
      <select class="form-select" id="task-priority">
        <option>High</option><option selected>Medium</option><option>Low</option>
      </select>
    </div>
    <button class="btn btn-primary" style="width: 100%;" onclick="closeDrawer()">Create task</button>
  </div>

  <!-- Center Modal -->
  <div class="modal-wrapper" id="modal-wrapper">
    <div class="modal" id="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title"></h2>
        <button class="btn-ghost" onclick="closeModal()" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-meta" id="modal-meta"></div>
      <div class="modal-actions">
        <button class="btn" style="background: var(--bg-muted); color: var(--text-primary); border: 1px solid var(--border-default);" onclick="closeModal()">Close</button>
        <button class="btn btn-primary" onclick="closeModal()">Mark complete</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { animate, spring } from "https://cdn.jsdelivr.net/npm/motion@11/+esm";

    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const drawer = document.getElementById('drawer');
    const modal = document.getElementById('modal');
    const modalWrapper = document.getElementById('modal-wrapper');
    const backdrop = document.getElementById('backdrop');
    const pageWrapper = document.getElementById('page-wrapper');

    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.documentElement.dataset.theme = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    });

    const taskDetails = [
      { name: 'Review Q4 analytics report', desc: 'Go through the quarterly analytics data, identify key trends, and prepare a summary for the team standup. Focus on user engagement metrics and conversion funnel changes.', due: 'Due tomorrow', priority: 'High' },
      { name: 'Update design system tokens', desc: 'Migrate remaining hex color values to oklch format. Update the dark mode semantic tokens to ensure proper contrast ratios. Test across all components.', due: 'Due Friday', priority: 'Medium' },
      { name: 'Write API documentation', desc: 'Document the new endpoints for the project management API. Include request/response examples, error codes, and authentication requirements.', due: 'Due next week', priority: 'Low' },
      { name: 'Prepare quarterly presentation', desc: 'Create slides covering team accomplishments, metrics improvements, and the roadmap for next quarter. Include the new design system adoption stats.', due: 'Due in 2 weeks', priority: 'Medium' },
      { name: 'Migrate database schema', desc: 'Plan and execute the schema migration for the new multi-tenant architecture. Ensure backward compatibility during the rollout period.', due: 'No deadline', priority: 'High' },
    ];

    // Open drawer
    document.getElementById('btn-add-task').addEventListener('click', () => {
      backdrop.classList.add('visible');
      pageWrapper.classList.add('scaled');
      if (!prefersReduced) {
        animate(drawer, { y: ['100%', '0%'] }, { type: spring, stiffness: 400, damping: 35 });
      } else {
        drawer.style.transform = 'translateY(0)';
      }
    });

    // Close drawer
    window.closeDrawer = function() {
      if (!prefersReduced) {
        animate(drawer, { y: '100%' }, { duration: 0.25, easing: [0.4, 0, 1, 1] });
      } else {
        drawer.style.transform = 'translateY(100%)';
      }
      backdrop.classList.remove('visible');
      pageWrapper.classList.remove('scaled');
    };

    // Drawer drag-to-dismiss
    let dragging = false, startY = 0, currentY = 0;
    const handle = document.getElementById('drawer-handle');
    drawer.addEventListener('pointerdown', (e) => {
      if (e.target !== handle && e.target !== drawer) return;
      dragging = true; startY = e.clientY;
      drawer.setPointerCapture(e.pointerId);
    });
    drawer.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      currentY = Math.max(0, e.clientY - startY);
      drawer.style.transform = `translateY(${currentY}px)`;
    });
    drawer.addEventListener('pointerup', () => {
      if (!dragging) return;
      dragging = false;
      if (currentY > drawer.offsetHeight * 0.3) {
        closeDrawer();
      } else if (!prefersReduced) {
        animate(drawer, { y: '0%' }, { type: spring, stiffness: 500, damping: 30 });
      } else {
        drawer.style.transform = 'translateY(0)';
      }
      currentY = 0;
    });

    // Open modal
    document.querySelectorAll('.task-card').forEach(card => {
      function openTask() {
        const idx = card.dataset.task;
        const task = taskDetails[idx];
        document.getElementById('modal-title').textContent = task.name;
        document.getElementById('modal-body').innerHTML = `<p>${task.desc}</p>`;
        document.getElementById('modal-meta').innerHTML = `<span>${task.due}</span><span>Priority: ${task.priority}</span>`;
        backdrop.classList.add('visible');
        pageWrapper.classList.add('scaled');
        modalWrapper.style.pointerEvents = 'auto';
        if (!prefersReduced) {
          animate(modal, { scale: [0.96, 1], opacity: [0, 1] }, { type: spring, stiffness: 500, damping: 30 });
        } else {
          modal.style.opacity = '1'; modal.style.transform = 'none';
        }
      }
      card.addEventListener('click', openTask);
      card.addEventListener('keydown', (e) => { if (e.key === 'Enter') openTask(); });
    });

    // Close modal
    window.closeModal = function() {
      if (!prefersReduced) {
        animate(modal, { scale: 0.96, opacity: 0 }, { duration: 0.2, easing: [0.4, 0, 1, 1] })
          .then(() => { modalWrapper.style.pointerEvents = 'none'; });
      } else {
        modal.style.opacity = '0'; modalWrapper.style.pointerEvents = 'none';
      }
      backdrop.classList.remove('visible');
      pageWrapper.classList.remove('scaled');
    };

    // Backdrop click closes both
    backdrop.addEventListener('click', () => {
      if (modal.style.opacity !== '0' && modalWrapper.style.pointerEvents === 'auto') closeModal();
      else closeDrawer();
    });

    // ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (modalWrapper.style.pointerEvents === 'auto') closeModal();
        else closeDrawer();
      }
    });
  </script>
</body>
</html>
