<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>09 — Interactive Effects | Kyle DS Prototypes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primitive-neutral-50:  oklch(0.978 0.005 90);
      --primitive-neutral-100: oklch(0.958 0.006 90);
      --primitive-neutral-200: oklch(0.905 0.007 90);
      --primitive-neutral-300: oklch(0.855 0.008 90);
      --primitive-neutral-400: oklch(0.755 0.010 90);
      --primitive-neutral-600: oklch(0.490 0.010 90);
      --primitive-neutral-950: oklch(0.135 0.008 90);
      --primitive-blue-500: oklch(0.550 0.220 260);
      --primitive-blue-600: oklch(0.480 0.220 260);
      --bg-page: var(--primitive-neutral-50);
      --bg-surface: oklch(0.995 0.002 90);
      --bg-muted: var(--primitive-neutral-100);
      --text-primary: var(--primitive-neutral-950);
      --text-secondary: var(--primitive-neutral-600);
      --text-muted: var(--primitive-neutral-400);
      --border-default: var(--primitive-neutral-200);
      --border-strong: var(--primitive-neutral-300);
      --accent-blue: var(--primitive-blue-500);
      --accent-blue-hover: var(--primitive-blue-600);
      --accent-blue-subtle: oklch(0.920 0.045 260);
      --text-on-accent: oklch(0.995 0.002 90);
      --space-1: 4px; --space-2: 8px; --space-3: 12px;
      --space-4: 16px; --space-6: 24px; --space-8: 32px;
      --space-12: 48px; --space-16: 64px;
      --radius-sm: 6px; --radius-md: 10px; --radius-full: 9999px;
      --radius-lg: 12px;
      --radius-xl: 16px;
    }
    [data-theme="dark"] {
      --bg-page: oklch(0.135 0.010 90);
      --bg-surface: oklch(0.160 0.012 90);
      --bg-muted: oklch(0.205 0.012 90);
      --text-primary: oklch(0.95 0.003 90);
      --text-secondary: oklch(0.65 0.008 90);
      --text-muted: oklch(0.45 0.006 90);
      --border-default: oklch(0.260 0.012 90);
      --border-strong: oklch(0.330 0.012 90);
      --accent-blue: oklch(0.670 0.200 260);
      --accent-blue-hover: oklch(0.720 0.190 260);
      --accent-blue-subtle: oklch(0.250 0.060 260);
      --text-on-accent: oklch(0.995 0.002 90);
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      font-feature-settings: "cv02", "cv03", "cv04", "cv11";
      background: var(--bg-page); color: var(--text-primary);
      line-height: 1.6; -webkit-font-smoothing: antialiased;
    }

    .page { max-width: 900px; margin: 0 auto; padding: var(--space-12) var(--space-6); }
    .page-header { margin-bottom: var(--space-8); }
    .page-title { font-size: 1.75rem; font-weight: 650; letter-spacing: -0.02em; line-height: 1.2; margin-bottom: var(--space-2); }
    .page-description { color: var(--text-secondary); font-size: 0.9375rem; }

    .grid-2x2 { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); }
    @media (max-width: 640px) { .grid-2x2 { grid-template-columns: 1fr; } }

    .panel {
      background: var(--bg-surface); border: 1px solid var(--border-default);
      border-radius: var(--radius-md); padding: var(--space-6);
      min-height: 320px; display: flex; flex-direction: column;
    }
    .panel-label {
      font-size: 0.6875rem; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: var(--space-4);
    }
    .panel-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }

    /* Panel 1: Magnetic Button */
    .magnetic-area { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; position: relative; }
    .magnetic-btn {
      padding: var(--space-3) var(--space-8); font-family: inherit; font-size: 0.9375rem;
      font-weight: 600; background: var(--accent-blue); color: var(--text-on-accent);
      border: none; border-radius: var(--radius-md); cursor: pointer;
      will-change: transform;
    }
    .magnetic-btn:hover { background: var(--accent-blue-hover); }
    .magnetic-btn:focus-visible { outline: 2px solid var(--accent-blue); outline-offset: 2px; }

    /* Panel 2: Number Counter */
    .stats { display: flex; gap: var(--space-6); justify-content: center; width: 100%; }
    .stat { text-align: center; }
    .stat-value {
      font-family: 'JetBrains Mono', monospace; font-size: 2rem; font-weight: 700;
      letter-spacing: -0.02em; color: var(--accent-blue); line-height: 1;
      overflow: hidden; height: 2.4rem;
    }
    .stat-label { font-size: 0.75rem; color: var(--text-muted); margin-top: var(--space-2); }
    .digit-col {
      display: inline-block; overflow: hidden; height: 1em; vertical-align: top; position: relative;
    }
    .digit-strip {
      display: flex; flex-direction: column; transition: transform 600ms cubic-bezier(0.2, 0, 0, 1);
    }
    .digit-strip span { display: block; height: 1em; line-height: 1; }
    .reset-btn {
      margin-top: var(--space-4); font-size: 0.75rem; color: var(--text-muted);
      background: none; border: 1px solid var(--border-default); border-radius: var(--radius-sm);
      padding: 2px 8px; cursor: pointer; font-family: inherit;
    }
    .reset-btn:hover { color: var(--text-secondary); border-color: var(--border-strong); }

    /* Panel 3: Drag Reorder */
    .reorder-list { width: 100%; display: flex; flex-direction: column; gap: var(--space-2); }
    .reorder-item {
      display: flex; align-items: center; gap: var(--space-3);
      padding: var(--space-3) var(--space-4); background: var(--bg-page);
      border: 1px solid var(--border-default); border-radius: var(--radius-sm);
      cursor: grab; user-select: none; touch-action: none;
      transition: box-shadow 160ms ease-out;
    }
    .reorder-item:active { cursor: grabbing; }
    .reorder-item.dragging {
      box-shadow: 0 4px 16px oklch(0 0 0 / 0.1);
      z-index: 10; position: relative;
    }
    .grip {
      display: grid; grid-template-columns: repeat(2, 4px); gap: 2px;
      color: var(--text-muted); flex-shrink: 0;
    }
    .grip span { width: 4px; height: 4px; background: currentColor; border-radius: 50%; }
    .reorder-label { font-size: 0.875rem; font-weight: 500; }

    /* Panel 4: SVG Draw */
    .svg-container { position: relative; }
    .svg-draw path, .svg-draw circle, .svg-draw polyline {
      stroke: var(--accent-blue); stroke-width: 2; fill: none;
      stroke-linecap: round; stroke-linejoin: round;
    }
    @media (prefers-reduced-motion: no-preference) {
      .svg-draw.animate path, .svg-draw.animate circle, .svg-draw.animate polyline {
        animation: draw-stroke 1.2s cubic-bezier(0.2, 0, 0, 1) forwards;
      }
      @keyframes draw-stroke {
        from { stroke-dashoffset: var(--path-length); }
        to { stroke-dashoffset: 0; }
      }
    }
    .svg-replay {
      margin-top: var(--space-4); font-size: 0.75rem; color: var(--text-muted);
      background: none; border: 1px solid var(--border-default); border-radius: var(--radius-sm);
      padding: 2px 8px; cursor: pointer; font-family: inherit;
    }
    .svg-replay:hover { color: var(--text-secondary); border-color: var(--border-strong); }

    /* Legend */
    .legend { margin-top: var(--space-12); padding: var(--space-6); background: var(--bg-muted); border-radius: var(--radius-md); font-size: 0.8125rem; color: var(--text-secondary); }
    .legend h3 { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: var(--space-3); }
    .legend-item { display: flex; gap: var(--space-3); padding: var(--space-2) 0; border-bottom: 1px solid var(--border-default); }
    .legend-item:last-child { border-bottom: none; }
    .legend-label { font-weight: 500; color: var(--text-primary); white-space: nowrap; }

    .theme-toggle { position: fixed; top: var(--space-4); right: var(--space-4); z-index: 100; background: var(--bg-surface); border: 1px solid var(--border-default); border-radius: var(--radius-full); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); }
    .theme-toggle:hover { border-color: var(--border-strong); color: var(--text-primary); }
    .theme-toggle .icon-sun, [data-theme="dark"] .theme-toggle .icon-moon { display: none; }
    [data-theme="dark"] .theme-toggle .icon-sun { display: block; }
    .theme-toggle .icon-moon { display: block; }
  </style>
</head>
<body>
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
    <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
    <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
  </button>

  <div class="page">
    <header class="page-header">
      <h1 class="page-title">Interactive Playground</h1>
      <p class="page-description">Four distinctive interaction patterns — magnetic pull, odometer counters, drag-reorder, and SVG path drawing.</p>
    </header>

    <div class="grid-2x2">
      <!-- Panel 1: Magnetic Button -->
      <div class="panel">
        <div class="panel-label">Magnetic Button</div>
        <div class="panel-content">
          <div class="magnetic-area" id="magnetic-area">
            <button class="magnetic-btn" id="magnetic-btn">Get started</button>
          </div>
        </div>
      </div>

      <!-- Panel 2: Number Counter -->
      <div class="panel">
        <div class="panel-label">Odometer Counter</div>
        <div class="panel-content">
          <div class="stats" id="counter-panel">
            <div class="stat">
              <div class="stat-value" data-target="1247" id="counter-1"></div>
              <div class="stat-label">Commits</div>
            </div>
            <div class="stat">
              <div class="stat-value" data-target="98.6" id="counter-2"></div>
              <div class="stat-label">Uptime %</div>
            </div>
            <div class="stat">
              <div class="stat-value" data-target="342" id="counter-3"></div>
              <div class="stat-label">Avg ms</div>
            </div>
          </div>
          <button class="reset-btn" id="counter-reset">Reset</button>
        </div>
      </div>

      <!-- Panel 3: Drag Reorder -->
      <div class="panel">
        <div class="panel-label">Drag & Reorder</div>
        <div class="panel-content" style="justify-content: flex-start; padding-top: 0;">
          <div class="reorder-list" id="reorder-list">
            <div class="reorder-item" data-index="0">
              <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>
              <span class="reorder-label">Design tokens</span>
            </div>
            <div class="reorder-item" data-index="1">
              <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>
              <span class="reorder-label">Typography scale</span>
            </div>
            <div class="reorder-item" data-index="2">
              <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>
              <span class="reorder-label">Color palette</span>
            </div>
            <div class="reorder-item" data-index="3">
              <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>
              <span class="reorder-label">Component library</span>
            </div>
            <div class="reorder-item" data-index="4">
              <div class="grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>
              <span class="reorder-label">Motion system</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel 4: SVG Path Draw -->
      <div class="panel">
        <div class="panel-label">SVG Path Drawing</div>
        <div class="panel-content">
          <div class="svg-container">
            <!-- Checkmark in circle -->
            <svg class="svg-draw" id="svg-draw" width="120" height="120" viewBox="0 0 120 120" fill="none">
              <circle cx="60" cy="60" r="50" style="--path-length: 314; stroke-dasharray: 314; stroke-dashoffset: 314;"/>
              <polyline points="40,62 55,77 82,45" style="--path-length: 65; stroke-dasharray: 65; stroke-dashoffset: 65; animation-delay: 0.4s;"/>
            </svg>
          </div>
          <button class="svg-replay" id="svg-replay">Replay</button>
        </div>
      </div>
    </div>

    <div class="legend">
      <h3>Animation Reference</h3>
      <div class="legend-item"><span class="legend-label">Magnetic</span><span>Cursor distance &lt; 120px → button shifts 30% toward cursor. Spring: stiffness 400, damping 20. Snap-back: 500/30.</span></div>
      <div class="legend-item"><span class="legend-label">Counter</span><span>Individual digit columns scroll to target. 600ms standard easing. Stagger: 50ms left-to-right.</span></div>
      <div class="legend-item"><span class="legend-label">Drag reorder</span><span>Pointer events for drag. Siblings shift via transform. Spring snap-back on drop.</span></div>
      <div class="legend-item"><span class="legend-label">SVG draw</span><span>stroke-dasharray/offset, 1.2s standard easing. Circle draws first, checkmark at 0.4s delay.</span></div>
    </div>
  </div>

  <script type="module">
    import { animate, spring } from "https://cdn.jsdelivr.net/npm/motion@11/+esm";

    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.documentElement.dataset.theme = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    });

    // === Panel 1: Magnetic Button ===
    const magneticArea = document.getElementById('magnetic-area');
    const magneticBtn = document.getElementById('magnetic-btn');

    if (!prefersReduced) {
      magneticArea.addEventListener('mousemove', (e) => {
        const rect = magneticBtn.getBoundingClientRect();
        const btnCenterX = rect.left + rect.width / 2;
        const btnCenterY = rect.top + rect.height / 2;
        const dx = e.clientX - btnCenterX;
        const dy = e.clientY - btnCenterY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < 120) {
          const pull = 0.3;
          animate(magneticBtn, { x: dx * pull, y: dy * pull }, { type: spring, stiffness: 400, damping: 20 });
        }
      });
      magneticArea.addEventListener('mouseleave', () => {
        animate(magneticBtn, { x: 0, y: 0 }, { type: spring, stiffness: 500, damping: 30 });
      });
    }

    // === Panel 2: Odometer Counter ===
    function buildOdometer(el, targetStr) {
      el.innerHTML = '';
      const chars = targetStr.split('');
      chars.forEach((char, i) => {
        if (char === '.' || char === ',') {
          const sep = document.createElement('span');
          sep.textContent = char;
          sep.style.display = 'inline-block';
          el.appendChild(sep);
          return;
        }
        const col = document.createElement('span');
        col.className = 'digit-col';
        const strip = document.createElement('span');
        strip.className = 'digit-strip';
        for (let n = 0; n <= 9; n++) {
          const d = document.createElement('span');
          d.textContent = n;
          strip.appendChild(d);
        }
        strip.style.transform = 'translateY(0)';
        col.appendChild(strip);
        el.appendChild(col);
      });
    }

    function animateOdometer(el, targetStr) {
      const digits = el.querySelectorAll('.digit-strip');
      const numericChars = targetStr.replace(/[.,]/g, '').split('');
      let digitIdx = 0;
      numericChars.forEach((char, i) => {
        const target = parseInt(char);
        const strip = digits[digitIdx];
        if (!strip) return;
        digitIdx++;
        setTimeout(() => {
          strip.style.transform = `translateY(-${target}em)`;
        }, i * 50);
      });
    }

    function resetOdometer(el) {
      el.querySelectorAll('.digit-strip').forEach(strip => {
        strip.style.transform = 'translateY(0)';
      });
    }

    const counterTargets = [
      { el: document.getElementById('counter-1'), target: '1,247' },
      { el: document.getElementById('counter-2'), target: '98.6' },
      { el: document.getElementById('counter-3'), target: '342' },
    ];
    counterTargets.forEach(c => buildOdometer(c.el, c.target));

    // Trigger on viewport entry
    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          counterTargets.forEach(c => animateOdometer(c.el, c.target));
          counterObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    counterObserver.observe(document.getElementById('counter-panel'));

    document.getElementById('counter-reset').addEventListener('click', () => {
      counterTargets.forEach(c => resetOdometer(c.el));
      setTimeout(() => counterTargets.forEach(c => animateOdometer(c.el, c.target)), 300);
    });

    // === Panel 3: Drag Reorder ===
    const reorderList = document.getElementById('reorder-list');
    let draggedItem = null, dragStartY = 0, dragOffsetY = 0, itemHeight = 0;

    reorderList.addEventListener('pointerdown', (e) => {
      const item = e.target.closest('.reorder-item');
      if (!item) return;
      draggedItem = item;
      dragStartY = e.clientY;
      itemHeight = item.offsetHeight + 8; // gap
      draggedItem.classList.add('dragging');
      draggedItem.setPointerCapture(e.pointerId);
      if (!prefersReduced) {
        animate(draggedItem, { scale: 1.02 }, { duration: 0.1 });
      }
    });

    reorderList.addEventListener('pointermove', (e) => {
      if (!draggedItem) return;
      dragOffsetY = e.clientY - dragStartY;
      draggedItem.style.transform = `translateY(${dragOffsetY}px) scale(1.02)`;

      // Shift siblings
      const items = [...reorderList.children];
      const dragIndex = items.indexOf(draggedItem);
      items.forEach((item, i) => {
        if (item === draggedItem) return;
        const shift = (dragOffsetY > 0 && i > dragIndex && i <= dragIndex + Math.round(dragOffsetY / itemHeight))
          ? -itemHeight
          : (dragOffsetY < 0 && i < dragIndex && i >= dragIndex + Math.round(dragOffsetY / itemHeight))
          ? itemHeight : 0;
        item.style.transform = `translateY(${shift}px)`;
        item.style.transition = 'transform 200ms cubic-bezier(0.2, 0, 0, 1)';
      });
    });

    reorderList.addEventListener('pointerup', () => {
      if (!draggedItem) return;
      const items = [...reorderList.children];
      const dragIndex = items.indexOf(draggedItem);
      const moveBy = Math.round(dragOffsetY / itemHeight);
      const newIndex = Math.max(0, Math.min(items.length - 1, dragIndex + moveBy));

      // Reorder DOM
      if (newIndex !== dragIndex) {
        if (newIndex > dragIndex) {
          reorderList.insertBefore(draggedItem, items[newIndex + 1] || null);
        } else {
          reorderList.insertBefore(draggedItem, items[newIndex]);
        }
      }

      // Reset transforms
      items.forEach(item => {
        item.style.transform = '';
        item.style.transition = '';
      });
      draggedItem.classList.remove('dragging');
      draggedItem = null;
      dragOffsetY = 0;
    });

    // === Panel 4: SVG Path Draw ===
    function triggerSvgDraw() {
      const svg = document.getElementById('svg-draw');
      svg.classList.remove('animate');
      void svg.offsetWidth;
      svg.classList.add('animate');
    }

    const svgObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          triggerSvgDraw();
          svgObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    svgObserver.observe(document.getElementById('svg-draw'));

    document.getElementById('svg-replay').addEventListener('click', triggerSvgDraw);
  </script>
</body>
</html>
