<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Delightful — Animation System</title>
  <meta name="description" content="JS-powered animations: spring physics, particles, generative art, and interactive playgrounds. Part of the Delightful Design System." />
  <meta property="og:title" content="Delightful — Animation System" />
  <meta property="og:description" content="Spring physics, particles, FLIP, gestures, generative art — all vanilla JS, all token-driven." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet" />

  <style>
    /* ==========================================================================
       TIER 1 — PRIMITIVES
       Raw oklch values. Named by scale, no semantic meaning.
       ========================================================================== */
    :root {
      --primitive-neutral-0: oklch(1.00 0.000 0);
      --primitive-neutral-25: oklch(0.988 0.006 70);
      --primitive-neutral-50: oklch(0.980 0.008 70);
      --primitive-neutral-100: oklch(0.960 0.010 70);
      --primitive-neutral-150: oklch(0.940 0.012 70);
      --primitive-neutral-200: oklch(0.920 0.012 70);
      --primitive-neutral-300: oklch(0.860 0.014 70);
      --primitive-neutral-400: oklch(0.750 0.014 70);
      --primitive-neutral-500: oklch(0.600 0.012 70);
      --primitive-neutral-600: oklch(0.480 0.010 70);
      --primitive-neutral-700: oklch(0.350 0.010 70);
      --primitive-neutral-800: oklch(0.250 0.012 60);
      --primitive-neutral-900: oklch(0.180 0.012 60);
      --primitive-neutral-950: oklch(0.140 0.012 60);

      --primitive-pink-100: oklch(0.920 0.060 350);
      --primitive-pink-200: oklch(0.840 0.140 350);
      --primitive-pink-300: oklch(0.720 0.220 350);
      --primitive-pink-400: oklch(0.640 0.270 350);
      --primitive-pink-500: oklch(0.560 0.280 350);

      --primitive-red-100: oklch(0.930 0.050 20);
      --primitive-red-200: oklch(0.850 0.110 20);
      --primitive-red-300: oklch(0.720 0.180 20);
      --primitive-red-400: oklch(0.620 0.220 20);
      --primitive-red-500: oklch(0.540 0.230 20);

      --primitive-gold-100: oklch(0.960 0.050 85);
      --primitive-gold-200: oklch(0.920 0.110 85);
      --primitive-gold-300: oklch(0.870 0.160 85);
      --primitive-gold-400: oklch(0.840 0.175 85);
      --primitive-gold-500: oklch(0.820 0.165 84);

      --primitive-cyan-100: oklch(0.930 0.038 210);
      --primitive-cyan-200: oklch(0.850 0.085 210);
      --primitive-cyan-300: oklch(0.740 0.125 210);
      --primitive-cyan-400: oklch(0.650 0.148 210);
      --primitive-cyan-500: oklch(0.570 0.155 210);

      --primitive-green-100: oklch(0.930 0.042 148);
      --primitive-green-200: oklch(0.840 0.095 148);
      --primitive-green-300: oklch(0.730 0.145 148);
      --primitive-green-400: oklch(0.630 0.170 148);
      --primitive-green-500: oklch(0.540 0.165 148);

      --primitive-purple-100: oklch(0.940 0.040 300);
      --primitive-purple-200: oklch(0.860 0.080 300);
      --primitive-purple-300: oklch(0.720 0.160 300);
      --primitive-purple-400: oklch(0.640 0.220 300);
      --primitive-purple-500: oklch(0.560 0.260 300);
    }

    /* ==========================================================================
       TIER 2 — SEMANTIC TOKENS (Light)
       ========================================================================== */
    :root,
    [data-theme="light"] {
      --bg-page: oklch(0.982 0.008 70);
      --bg-surface: oklch(0.995 0.004 70);
      --bg-elevated: oklch(1.00 0.00 0);
      --bg-subtle: oklch(0.965 0.012 70);
      --bg-muted: oklch(0.948 0.014 70);

      --text-primary: oklch(0.200 0.015 60);
      --text-secondary: oklch(0.420 0.015 60);
      --text-muted: oklch(0.560 0.012 60);
      --text-on-accent: oklch(1.00 0.000 0);
      --text-on-gold: oklch(0.220 0.020 70);

      --border-default: var(--text-primary);
      --border-strong: var(--text-primary);
      --border-subtle: oklch(0.820 0.015 70);

      --accent-primary: oklch(0.640 0.270 350);
      --accent-primary-hover: oklch(0.580 0.280 350);
      --accent-primary-subtle: oklch(0.955 0.040 350);
      --accent-primary-text: oklch(0.560 0.270 350);

      --accent-danger: oklch(0.620 0.220 20);
      --accent-danger-hover: oklch(0.570 0.230 20);
      --accent-danger-subtle: oklch(0.950 0.040 20);
      --accent-danger-text: oklch(0.550 0.220 20);

      --accent-gold: oklch(0.840 0.175 85);
      --accent-gold-hover: oklch(0.820 0.165 84);
      --accent-gold-subtle: oklch(0.965 0.060 85);
      --accent-gold-text: oklch(0.440 0.130 85);

      --accent-cyan: oklch(0.650 0.148 210);
      --accent-cyan-hover: oklch(0.600 0.150 210);
      --accent-cyan-subtle: oklch(0.945 0.030 210);
      --accent-cyan-text: oklch(0.520 0.148 210);

      --accent-green: oklch(0.630 0.170 148);
      --accent-green-hover: oklch(0.580 0.165 148);
      --accent-green-subtle: oklch(0.945 0.035 148);
      --accent-green-text: oklch(0.480 0.165 148);

      --accent-purple: oklch(0.640 0.220 300);
      --accent-purple-hover: oklch(0.580 0.230 300);
      --accent-purple-subtle: oklch(0.950 0.035 300);
      --accent-purple-text: oklch(0.520 0.220 300);

      --status-info: var(--accent-primary);
      --status-error: var(--accent-danger);
      --status-warning: var(--accent-gold);
      --status-success: var(--accent-green);

      --focus-ring: var(--accent-primary);
      --overlay-bg: oklch(0.200 0.015 60 / 0.30);

      --shadow-sm: 2px 2px 0 var(--text-primary);
      --shadow-md: 4px 4px 0 var(--text-primary);
      --shadow-lg: 8px 8px 0 var(--text-primary);
      --shadow-pink: 4px 4px 0 var(--accent-primary);
      --shadow-danger: 4px 4px 0 var(--accent-danger);
      --shadow-gold: 4px 4px 0 var(--accent-gold);
      --shadow-cyan: 4px 4px 0 var(--accent-cyan);
      --shadow-green: 4px 4px 0 var(--accent-green);
      --shadow-purple: 4px 4px 0 var(--accent-purple);
    }

    /* ==========================================================================
       TIER 2 — SEMANTIC TOKENS (Dark)
       ========================================================================== */
    [data-theme="dark"] {
      --bg-page: oklch(0.140 0.014 65);
      --bg-surface: oklch(0.165 0.015 65);
      --bg-elevated: oklch(0.190 0.015 65);
      --bg-subtle: oklch(0.210 0.015 65);
      --bg-muted: oklch(0.180 0.013 65);

      --text-primary: oklch(0.935 0.008 70);
      --text-secondary: oklch(0.690 0.012 70);
      --text-muted: oklch(0.540 0.010 70);
      --text-on-accent: oklch(1.00 0.000 0);
      --text-on-gold: oklch(0.140 0.014 65);

      --border-default: oklch(0.550 0.010 65);
      --border-strong: var(--text-primary);
      --border-subtle: oklch(0.330 0.015 65);

      --accent-primary: oklch(0.700 0.230 350);
      --accent-primary-hover: oklch(0.740 0.220 350);
      --accent-primary-subtle: oklch(0.250 0.065 350);
      --accent-primary-text: oklch(0.750 0.210 350);

      --accent-danger: oklch(0.660 0.200 20);
      --accent-danger-hover: oklch(0.700 0.190 20);
      --accent-danger-subtle: oklch(0.250 0.055 20);
      --accent-danger-text: oklch(0.720 0.180 20);

      --accent-gold: oklch(0.840 0.170 85);
      --accent-gold-hover: oklch(0.870 0.155 84);
      --accent-gold-subtle: oklch(0.260 0.065 85);
      --accent-gold-text: oklch(0.870 0.155 85);

      --accent-cyan: oklch(0.720 0.140 210);
      --accent-cyan-hover: oklch(0.760 0.130 210);
      --accent-cyan-subtle: oklch(0.250 0.045 210);
      --accent-cyan-text: oklch(0.780 0.130 210);

      --accent-green: oklch(0.680 0.155 148);
      --accent-green-hover: oklch(0.720 0.145 148);
      --accent-green-subtle: oklch(0.250 0.048 148);
      --accent-green-text: oklch(0.740 0.145 148);

      --accent-purple: oklch(0.700 0.200 300);
      --accent-purple-hover: oklch(0.740 0.190 300);
      --accent-purple-subtle: oklch(0.250 0.055 300);
      --accent-purple-text: oklch(0.760 0.180 300);

      --status-info: var(--accent-primary);
      --status-error: var(--accent-danger);
      --status-warning: var(--accent-gold);
      --status-success: var(--accent-green);

      --focus-ring: oklch(0.700 0.230 350);
      --overlay-bg: oklch(0 0 0 / 0.60);

      --shadow-sm: 2px 2px 0 oklch(0.92 0.010 65);
      --shadow-md: 4px 4px 0 oklch(0.92 0.010 65);
      --shadow-lg: 8px 8px 0 oklch(0.92 0.010 65);
      --shadow-pink: 4px 4px 0 var(--accent-primary);
      --shadow-danger: 4px 4px 0 var(--accent-danger);
      --shadow-gold: 4px 4px 0 var(--accent-gold);
      --shadow-cyan: 4px 4px 0 var(--accent-cyan);
      --shadow-green: 4px 4px 0 var(--accent-green);
      --shadow-purple: 4px 4px 0 var(--accent-purple);
    }

    /* ==========================================================================
       TIER 3 — COMPONENT TOKENS + TYPOGRAPHY + SPACING + MOTION
       ========================================================================== */
    :root {
      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', ui-monospace, 'Cascadia Code', monospace;

      --step--2: clamp(0.694rem, 0.650rem + 0.22vi, 0.8rem);
      --step--1: clamp(0.833rem, 0.775rem + 0.29vi, 1rem);
      --step-0: clamp(1rem, 0.913rem + 0.43vi, 1.25rem);
      --step-1: clamp(1.2rem, 1.074rem + 0.63vi, 1.5625rem);
      --step-2: clamp(1.44rem, 1.261rem + 0.89vi, 1.953rem);
      --step-3: clamp(1.728rem, 1.480rem + 1.24vi, 2.441rem);
      --step-4: clamp(2.074rem, 1.734rem + 1.70vi, 3.052rem);
      --step-5: clamp(2.488rem, 2.028rem + 2.30vi, 3.815rem);

      --tracking-tight: -0.02em;
      --tracking-tighter: -0.03em;
      --tracking-tightest: -0.04em;

      --leading-none: 1.0;
      --leading-tight: 1.15;
      --leading-snug: 1.3;
      --leading-normal: 1.55;
      --leading-relaxed: 1.65;

      --ui-text-2xs: 0.6875rem;
      --ui-text-xs:  0.75rem;
      --ui-text-sm:  0.8125rem;
      --ui-text-md:  0.875rem;
      --ui-text-lg:  0.9375rem;
      --ui-text-xl:  1.0625rem;

      --space-1: 4px;
      --space-1-5: 6px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      --space-20: 80px;

      --radius-sm: 10px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-xl: 32px;
      --radius-full: 9999px;

      --control-sm: 32px;
      --control-md: 36px;
      --control-lg: 44px;
      --control-xl: 56px;

      --motion-instant: 100ms;
      --motion-fast: 160ms;
      --motion-base: 240ms;
      --motion-slow: 360ms;
      --motion-deliberate: 500ms;
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
      --ease-smooth: cubic-bezier(0.22, 1, 0.36, 1);
      --ease-slam: cubic-bezier(0.55, 0.06, 0.68, 0.19);
      --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);

      --btn-primary-bg: var(--accent-primary);
      --btn-primary-text: var(--text-on-accent);
      --btn-danger-bg: var(--accent-danger);
      --btn-danger-text: var(--text-on-accent);
      --btn-gold-bg: var(--accent-gold);
      --btn-gold-text: var(--text-on-gold);
      --btn-cyan-bg: var(--accent-cyan);
      --btn-cyan-text: var(--text-on-accent);
      --btn-green-bg: var(--accent-green);
      --btn-green-text: var(--text-on-accent);
      --btn-purple-bg: var(--accent-purple);
      --btn-purple-text: var(--text-on-accent);
      --btn-gap: var(--space-1-5);

      --badge-py: 2px;
      --badge-px: 10px;

      --toggle-off-bg: var(--primitive-neutral-300);
      --toggle-on-bg: var(--accent-primary);
      --toggle-knob: var(--primitive-neutral-0);

      --z-base: 1;
      --z-sticky: 100;
      --z-fixed: 200;
      --z-overlay: 300;
      --z-modal: 1000;
      --z-toast: 1100;
      --z-tooltip: 1500;

      --container-sm: 640px;
      --container-md: 960px;
      --container-lg: 1200px;
    }

    /* ==========================================================================
       RESET & BASE
       ========================================================================== */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; scroll-padding-top: 72px; }
    body {
      font-family: var(--font-sans);
      font-size: var(--step-0);
      line-height: var(--leading-normal);
      color: var(--text-primary);
      background: var(--bg-page);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-feature-settings: "cv02", "cv03", "cv04", "cv11";
    }
    :focus-visible { outline: 2px solid var(--focus-ring); outline-offset: 2px; }

    /* ==========================================================================
       SCROLL PROGRESS BAR
       ========================================================================== */
    .scroll-progress {
      position: fixed; top: 0; left: 0; right: 0; height: 3px;
      background: var(--accent-primary); transform-origin: left;
      z-index: var(--z-overlay);
    }
    @media (prefers-reduced-motion: no-preference) {
      @supports (animation-timeline: scroll()) {
        .scroll-progress {
          transform: scaleX(0);
          animation: scroll-progress-fill linear both;
          animation-timeline: scroll();
        }
        @keyframes scroll-progress-fill {
          0% { transform: scaleX(0); background-color: var(--accent-primary); }
          99% { background-color: var(--accent-primary); }
          100% { transform: scaleX(1); background-color: var(--accent-green); }
        }
      }
    }

    /* ==========================================================================
       NAV
       ========================================================================== */
    .topnav {
      position: fixed; top: 0; left: 0; right: 0; z-index: var(--z-fixed);
      background: oklch(0.995 0.004 70 / 0.88);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-bottom: 2px solid var(--border-subtle);
    }
    [data-theme="dark"] .topnav {
      background: oklch(0.165 0.015 65 / 0.88);
    }
    .topnav-inner {
      max-width: 1200px; margin: 0 auto;
      display: flex; align-items: center;
      padding: var(--space-3) var(--space-6); gap: var(--space-4);
    }
    .topnav-brand {
      display: flex; align-items: center; gap: var(--space-2);
      font-weight: 900; font-size: var(--step-1); letter-spacing: var(--tracking-tight);
      white-space: nowrap; text-decoration: none; color: var(--text-primary);
    }
    .brand-dots { display: flex; gap: 4px; }
    .brand-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .nav-links {
      display: flex; gap: var(--space-1); list-style: none;
      overflow-x: auto; flex: 1; scrollbar-width: none;
    }
    .nav-links::-webkit-scrollbar { display: none; }
    .nav-links a {
      font-size: var(--ui-text-sm); font-weight: 600; color: var(--text-secondary);
      text-decoration: none; padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-sm); white-space: nowrap;
      transition: color var(--motion-instant) ease-out, background var(--motion-instant) ease-out;
    }
    .nav-links a:hover { color: var(--text-primary); background: var(--bg-subtle); }
    .nav-right { display: flex; gap: var(--space-2); align-items: center; }
    .nav-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      border: 2px solid var(--border-default); background: var(--bg-surface);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--text-primary); text-decoration: none;
      transition: background var(--motion-instant) ease-out, box-shadow var(--motion-instant) linear;
    }
    .nav-btn:hover { box-shadow: var(--shadow-sm); }
    .nav-btn:active { box-shadow: none; transform: translateY(1px); }
    .nav-btn svg { width: 18px; height: 18px; }
    .nav-kbd {
      font-size: var(--ui-text-xs); font-family: var(--font-sans);
      padding: 2px var(--space-1); border-radius: 4px;
      border: 1px solid var(--border-subtle); background: var(--bg-subtle);
      color: var(--text-muted); cursor: pointer; white-space: nowrap;
      transition: border-color var(--motion-instant) ease-out;
    }
    .nav-kbd:hover { border-color: var(--border-default); }
    .icon-sun { display: none; } .icon-moon { display: none; } .icon-monitor { display: none; }
    [data-theme="light"] .icon-sun { display: block; }
    [data-theme="dark"] .icon-moon { display: block; }
    [data-theme-mode="system"] .icon-sun, [data-theme-mode="system"] .icon-moon { display: none !important; }
    [data-theme-mode="system"] .icon-monitor { display: block; }
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .topnav-inner { padding: var(--space-3) var(--space-4); }
    }

    /* ==========================================================================
       PAGE LAYOUT
       ========================================================================== */
    .page-wrap {
      max-width: 1200px; margin: 0 auto;
      padding: calc(56px + var(--space-8)) var(--space-6) var(--space-20);
    }

    /* ==========================================================================
       HERO
       ========================================================================== */
    .hero {
      text-align: center; padding: var(--space-8) 0 var(--space-12);
      position: relative;
    }
    .hero-canvas-wrap {
      position: relative; width: 100%; height: 340px;
      margin-bottom: var(--space-6);
      border: 2px solid var(--border-default);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      overflow: hidden; background: var(--bg-subtle);
    }
    .hero-canvas {
      width: 100%; height: 100%; display: block;
    }
    .hero-canvas-hint {
      position: absolute; bottom: var(--space-3); left: 50%;
      transform: translateX(-50%);
      font-size: var(--ui-text-xs); color: var(--text-muted);
      background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full); padding: 2px var(--space-3);
      pointer-events: none; opacity: 0.8;
    }
    .hero-title {
      font-size: var(--step-5); font-weight: 900;
      letter-spacing: var(--tracking-tightest);
      line-height: var(--leading-none);
      margin-bottom: var(--space-4);
    }
    .hero-subtitle {
      font-size: var(--step-1); color: var(--text-secondary);
      max-width: 640px; margin: 0 auto var(--space-4);
      line-height: var(--leading-snug);
    }
    .hero-crosslink {
      font-size: var(--ui-text-sm); color: var(--text-muted);
      margin-bottom: var(--space-4);
    }
    .hero-crosslink a {
      color: var(--accent-primary-text); text-decoration: underline;
      text-underline-offset: 2px;
    }
    .hero-dots {
      display: flex; justify-content: center; gap: var(--space-3);
    }
    .hero-dot {
      width: 12px; height: 12px; border-radius: 50%;
      border: 2px solid var(--border-default);
    }

    /* ==========================================================================
       SECTION LAYOUT
       ========================================================================== */
    .anim-section {
      margin-bottom: var(--space-16);
      padding-bottom: var(--space-16);
      border-bottom: 2px dashed var(--border-subtle);
      content-visibility: auto;
      contain-intrinsic-size: auto 600px;
    }
    .anim-section:last-of-type { border-bottom: none; }
    .section-header { margin-bottom: var(--space-8); }
    .section-overline {
      font-size: var(--ui-text-xs); font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.08em;
      color: var(--text-muted); margin-bottom: var(--space-2);
      display: flex; align-items: center; gap: var(--space-2);
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%; display: inline-block;
    }
    .section-title {
      font-size: var(--step-3); font-weight: 800;
      letter-spacing: var(--tracking-tight);
      line-height: var(--leading-tight);
      margin-bottom: var(--space-2);
    }
    .section-desc {
      font-size: var(--step-0); color: var(--text-secondary);
      max-width: 640px; line-height: var(--leading-normal);
    }

    /* ==========================================================================
       DEMO CARD
       ========================================================================== */
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: var(--space-6);
    }
    .demo-card {
      background: var(--bg-surface);
      border: 2px solid var(--border-default);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      overflow: hidden; display: flex; flex-direction: column;
    }
    .demo-card-stage {
      padding: var(--space-6);
      display: flex; align-items: center; justify-content: center;
      background: var(--bg-subtle);
      border-bottom: 2px solid var(--border-subtle);
      min-height: 200px; position: relative; overflow: hidden;
    }
    .demo-card-stage canvas {
      width: 100%; height: 100%; display: block;
      position: absolute; inset: 0;
    }
    .demo-card-body {
      padding: var(--space-4); flex: 1;
      display: flex; flex-direction: column;
    }
    .demo-card-top {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: var(--space-2);
    }
    .demo-card-name {
      font-family: var(--font-mono); font-size: var(--ui-text-md);
      font-weight: 700; color: var(--text-primary);
    }
    .demo-card-desc {
      font-size: var(--ui-text-sm); color: var(--text-secondary);
      line-height: var(--leading-normal); margin-bottom: var(--space-3);
    }
    .demo-card-hint {
      font-size: var(--ui-text-xs); color: var(--text-muted);
      font-style: italic;
    }
    .demo-card-tags {
      display: flex; gap: var(--space-1); flex-wrap: wrap;
      margin-bottom: var(--space-2);
    }
    .tag {
      font-size: var(--ui-text-2xs); font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.04em;
      padding: 2px 10px; border: 2px solid var(--border-default);
      border-radius: var(--radius-full); color: var(--text-secondary);
    }
    .demo-btn {
      background: var(--accent-primary); color: var(--text-on-accent);
      border: 2px solid var(--border-default); border-radius: var(--radius-sm);
      font-family: var(--font-sans); font-size: var(--ui-text-xs);
      font-weight: 700; padding: var(--space-1) var(--space-3);
      cursor: pointer; white-space: nowrap;
      transition: transform var(--motion-instant) linear, box-shadow var(--motion-instant) linear;
    }
    .demo-btn:hover { box-shadow: var(--shadow-sm); transform: translateY(-1px); }
    .demo-btn:active { box-shadow: none; transform: translateY(1px); }
    .demo-btn-secondary {
      background: var(--bg-surface); color: var(--text-primary);
    }

    /* Wide demo card (full width) */
    .demo-card-wide { grid-column: 1 / -1; }
    .demo-card-wide .demo-card-stage { min-height: 300px; }

    /* Slider controls */
    .demo-controls {
      display: flex; gap: var(--space-4); flex-wrap: wrap;
      padding: var(--space-3) var(--space-4);
      border-top: 2px solid var(--border-subtle);
      background: var(--bg-muted);
    }
    .demo-control-group {
      display: flex; flex-direction: column; gap: 2px; flex: 1; min-width: 120px;
    }
    .demo-control-label {
      font-size: var(--ui-text-2xs); font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.04em;
      color: var(--text-muted); display: flex; justify-content: space-between;
    }
    .demo-control-label span { color: var(--accent-primary-text); font-family: var(--font-mono); }
    input[type="range"] {
      width: 100%; height: 6px; appearance: none;
      background: var(--border-subtle); border-radius: var(--radius-full);
      outline: none; cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 16px; height: 16px;
      border-radius: 50%; background: var(--accent-primary);
      border: 2px solid var(--border-default); cursor: pointer;
    }

    /* ==========================================================================
       FOOTER
       ========================================================================== */
    .ds-footer {
      text-align: center; padding: var(--space-12) var(--space-6);
      color: var(--text-secondary); border-top: 2px dashed var(--border-subtle);
    }
    .ds-footer a {
      color: var(--accent-primary-text); text-decoration: underline;
      text-underline-offset: 2px;
    }
    .ds-footer a:hover { color: var(--accent-primary); }

    /* ==========================================================================
       BACK TO TOP
       ========================================================================== */
    .back-to-top {
      position: fixed; bottom: var(--space-6); right: var(--space-6);
      z-index: var(--z-fixed); width: 44px; height: 44px;
      border-radius: var(--radius-sm); border: 2px solid var(--border-default);
      background: var(--bg-elevated); color: var(--text-primary);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      box-shadow: var(--shadow-md);
      opacity: 0; pointer-events: none;
      transition: opacity var(--motion-base) var(--ease-out), box-shadow var(--motion-instant) linear;
    }
    .back-to-top.visible { opacity: 1; pointer-events: auto; }
    .back-to-top:hover { box-shadow: var(--shadow-lg); }
    .back-to-top:active { box-shadow: var(--shadow-sm); transform: translateY(1px); }
    .back-to-top svg { width: 20px; height: 20px; }

    /* View transitions */
    ::view-transition-old(root),
    ::view-transition-new(root) { animation-duration: 240ms; }

    /* ==========================================================================
       COMMAND PALETTE
       ========================================================================== */
    .cmd-palette-overlay {
      position: fixed; inset: 0; z-index: var(--z-modal);
      background: var(--overlay-bg);
      display: none; align-items: flex-start; justify-content: center;
      padding-top: 20vh; opacity: 0;
      transition: opacity 200ms var(--ease-out), display 200ms var(--ease-out) allow-discrete;
    }
    .cmd-palette-overlay.active {
      display: flex; opacity: 1;
      @starting-style { opacity: 0; }
    }
    .cmd-palette {
      width: 100%; max-width: 520px;
      background: var(--bg-elevated); border: 2px solid var(--border-default);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);
      overflow: hidden;
      transform: scale(0.95) translateY(-10px); opacity: 0;
      transition: transform 240ms var(--ease-smooth), opacity 240ms var(--ease-smooth);
    }
    .cmd-palette-overlay.active .cmd-palette {
      transform: scale(1) translateY(0); opacity: 1;
      @starting-style { transform: scale(0.95) translateY(-10px); opacity: 0; }
    }
    .cmd-palette-input {
      width: 100%; padding: var(--space-4) var(--space-6);
      font-family: var(--font-sans); font-size: var(--step-0);
      border: none; border-bottom: 2px solid var(--border-subtle);
      background: transparent; color: var(--text-primary); outline: none;
    }
    .cmd-palette-input::placeholder { color: var(--text-muted); }
    .cmd-palette-list {
      list-style: none; max-height: 320px; overflow-y: auto;
      padding: var(--space-2) 0;
    }
    .cmd-palette-item {
      padding: var(--space-2) var(--space-6);
      font-size: var(--ui-text-md); color: var(--text-secondary);
      cursor: pointer; display: flex; align-items: center; gap: var(--space-3);
      transition: background var(--motion-instant) ease-out, color var(--motion-instant) ease-out;
    }
    .cmd-palette-item:hover,
    .cmd-palette-item.active {
      background: var(--bg-subtle); color: var(--text-primary);
    }
    .cmd-palette-item .cmd-section-dot {
      width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
    }
    .cmd-palette-empty {
      padding: var(--space-4) var(--space-6);
      color: var(--text-muted); font-size: var(--ui-text-sm); text-align: center;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <div class="scroll-progress" aria-hidden="true"></div>

  <!-- NAV -->
  <nav class="topnav" role="navigation" aria-label="Animation system navigation">
    <div class="topnav-inner">
      <a href="#" class="topnav-brand">
        <span class="brand-dots">
          <span class="brand-dot" style="background:var(--accent-primary)"></span>
          <span class="brand-dot" style="background:var(--accent-gold)"></span>
          <span class="brand-dot" style="background:var(--accent-cyan)"></span>
        </span>
        Delightful Animation
      </a>
      <ul class="nav-links">
        <li><a href="#springs">Springs</a></li>
        <li><a href="#particles">Particles</a></li>
        <li><a href="#physics">Physics</a></li>
        <li><a href="#flip">FLIP</a></li>
        <li><a href="#gestures">Gestures</a></li>
        <li><a href="#generative">Generative</a></li>
        <li><a href="#cursor">Cursor</a></li>
        <li><a href="#svg">SVG</a></li>
        <li><a href="#splashy">Splashy</a></li>
        <li><a href="#combined">Combined</a></li>
      </ul>
      <div class="nav-right">
        <kbd class="nav-kbd" id="cmd-k-trigger" title="Quick navigation">&#8984;K</kbd>
        <a href="delightful-design-system.html" class="nav-btn" aria-label="Design System" title="Design System">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
        </a>
        <a href="delightful-motion.html" class="nav-btn" aria-label="Motion System" title="Motion System">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M5 12h14"/><polyline points="12 5 19 12 12 19"/></svg>
        </a>
        <button class="nav-btn" id="theme-toggle" aria-label="Toggle theme (light / dark / system)">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
          <svg class="icon-monitor" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="page-wrap">

    <!-- HERO -->
    <section class="hero">
      <div class="hero-canvas-wrap">
        <canvas class="hero-canvas" id="hero-canvas" aria-label="Interactive particle constellation. Move your mouse or touch to interact."></canvas>
        <span class="hero-canvas-hint">Move mouse or touch to interact</span>
      </div>
      <h1 class="hero-title">Delightful Animation</h1>
      <p class="hero-subtitle">Spring physics, particle systems, generative art, and interactive playgrounds — all vanilla JS, all token-driven.</p>
      <p class="hero-crosslink">Part of the <a href="delightful-design-system.html">Delightful Design System</a> &middot; <a href="delightful-motion.html">Motion System</a></p>
      <div class="hero-dots">
        <span class="hero-dot" style="background:var(--accent-primary)"></span>
        <span class="hero-dot" style="background:var(--accent-gold)"></span>
        <span class="hero-dot" style="background:var(--accent-cyan)"></span>
      </div>
    </section>

    <!-- ================================================================
         1. SPRING PHYSICS
         ================================================================ -->
    <section id="springs" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-primary)"></span> Category 01</div>
        <h2 class="section-title">Spring Physics</h2>
        <p class="section-desc">Damped harmonic oscillators bring natural, organic motion to UI elements. Press, drag, and tweak parameters in real time.</p>
      </div>

      <div class="demo-grid">
        <!-- Spring Button -->
        <div class="demo-card">
          <div class="demo-card-stage" id="spring-btn-stage" style="cursor:pointer">
            <div id="spring-btn-el" style="
              width:160px;height:56px;display:flex;align-items:center;justify-content:center;
              background:var(--accent-primary);color:var(--text-on-accent);
              border:2px solid var(--border-default);border-radius:var(--radius-sm);
              box-shadow:var(--shadow-md);font-weight:700;font-size:var(--ui-text-md);
              user-select:none;pointer-events:none;
            ">Press Me</div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">spring-button</span>
              <span class="tag">Spring</span>
            </div>
            <p class="demo-card-desc">Click to compress with spring physics. Release bounces back with overshoot.</p>
            <p class="demo-card-hint">Click or tap the button</p>
          </div>
        </div>

        <!-- Spring Chain -->
        <div class="demo-card">
          <div class="demo-card-stage">
            <canvas id="spring-chain-canvas" aria-label="Spring chain: linked circles connected by springs that follow mouse"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">spring-chain</span>
              <span class="tag">Spring</span>
            </div>
            <p class="demo-card-desc">Linked elements connected by springs. The leader follows the cursor, trailing nodes follow with cascading delay.</p>
            <p class="demo-card-hint">Move mouse over the canvas</p>
          </div>
        </div>

        <!-- Spring Parameters Playground -->
        <div class="demo-card demo-card-wide">
          <div class="demo-card-stage" id="spring-params-stage">
            <canvas id="spring-params-canvas" aria-label="Spring parameters playground with adjustable stiffness, damping, and mass"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">spring-playground</span>
              <span class="tag">Spring</span>
              <span class="tag">Interactive</span>
            </div>
            <p class="demo-card-desc">Adjust stiffness, damping, and mass to see how spring parameters affect motion. Click the canvas to set a new target position.</p>
          </div>
          <div class="demo-controls">
            <div class="demo-control-group">
              <label class="demo-control-label">Stiffness <span id="spring-stiffness-val">180</span></label>
              <input type="range" id="spring-stiffness" min="20" max="600" value="180" />
            </div>
            <div class="demo-control-group">
              <label class="demo-control-label">Damping <span id="spring-damping-val">12</span></label>
              <input type="range" id="spring-damping" min="1" max="40" value="12" />
            </div>
            <div class="demo-control-group">
              <label class="demo-control-label">Mass <span id="spring-mass-val">1.0</span></label>
              <input type="range" id="spring-mass" min="0.1" max="5" step="0.1" value="1" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         2. PARTICLE SYSTEMS
         ================================================================ -->
    <section id="particles" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-gold)"></span> Category 02</div>
        <h2 class="section-title">Particle Systems</h2>
        <p class="section-desc">Object-pooled particle engines for confetti, fireworks, text explosions, and star fields. All running at 60fps with recycled particles.</p>
      </div>

      <div class="demo-grid">
        <!-- Confetti Cannon -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px">
            <canvas id="confetti-canvas" aria-label="Confetti cannon: click to fire colorful confetti particles"></canvas>
            <button class="demo-btn" id="confetti-fire" style="position:absolute;bottom:var(--space-3);left:50%;transform:translateX(-50%);z-index:2">Fire!</button>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">confetti-cannon</span>
              <span class="tag">Particles</span>
            </div>
            <p class="demo-card-desc">Click to launch a burst of confetti with gravity, rotation, and air resistance. Particles are pooled and recycled.</p>
            <p class="demo-card-hint">Click the Fire button or the canvas</p>
          </div>
        </div>

        <!-- Fireworks -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px;background:var(--bg-page)">
            <canvas id="fireworks-canvas" aria-label="Fireworks: click to launch multi-phase firework particles with trails"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">fireworks</span>
              <span class="tag">Particles</span>
            </div>
            <p class="demo-card-desc">Multi-phase particles: a rocket launches up, then explodes into trailing sparks with color shifts.</p>
            <p class="demo-card-hint">Click anywhere on the canvas</p>
          </div>
        </div>

        <!-- Particle Text -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px">
            <canvas id="particle-text-canvas" aria-label="Particle text: text rendered as particles that explode on hover"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">particle-text</span>
              <span class="tag">Particles</span>
              <span class="tag">Text</span>
            </div>
            <p class="demo-card-desc">Text rendered as individual particles. Hover to scatter them; they spring back into place when you move away.</p>
            <p class="demo-card-hint">Hover over the text</p>
          </div>
        </div>

        <!-- Star Field -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px;background:oklch(0.14 0.012 60)">
            <canvas id="starfield-canvas" aria-label="Star field: parallax space simulation with depth layers"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">star-field</span>
              <span class="tag">Particles</span>
            </div>
            <p class="demo-card-desc">Parallax star field with three depth layers. Stars streak past faster in the foreground for a warp-speed effect.</p>
            <p class="demo-card-hint">Move mouse to steer</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         3. PHYSICS PLAYGROUND
         ================================================================ -->
    <section id="physics" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-cyan)"></span> Category 03</div>
        <h2 class="section-title">Physics Playground</h2>
        <p class="section-desc">Gravity, collision detection, and Verlet integration for soft-body simulations. Interactive physics you can touch.</p>
      </div>

      <div class="demo-grid">
        <!-- Gravity Balls -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:280px">
            <canvas id="gravity-canvas" aria-label="Gravity balls: click to drop bouncing balls with realistic physics"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">gravity-balls</span>
              <span class="tag">Physics</span>
            </div>
            <p class="demo-card-desc">Click to drop balls that bounce with gravity and restitution. Each ball has a random size, color, and bounciness.</p>
            <p class="demo-card-hint">Click to drop balls</p>
          </div>
        </div>

        <!-- Verlet Cloth -->
        <div class="demo-card demo-card-wide">
          <div class="demo-card-stage" style="min-height:320px">
            <canvas id="cloth-canvas" aria-label="Verlet cloth simulation: drag to interact with a soft-body cloth"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">verlet-cloth</span>
              <span class="tag">Physics</span>
              <span class="tag">Verlet</span>
            </div>
            <p class="demo-card-desc">A grid of points connected by distance constraints, simulated with Verlet integration. Drag to interact with the cloth.</p>
            <p class="demo-card-hint">Click and drag on the cloth</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         4. FLIP & LAYOUT
         ================================================================ -->
    <section id="flip" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-green)"></span> Category 04</div>
        <h2 class="section-title">FLIP &amp; Layout Animation</h2>
        <p class="section-desc">First-Last-Invert-Play technique for smooth layout transitions. Elements animate from where they were to where they are.</p>
      </div>

      <div class="demo-grid">
        <!-- Card Shuffle -->
        <div class="demo-card demo-card-wide">
          <div class="demo-card-stage" style="min-height:auto;padding:var(--space-6)">
            <div id="flip-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:var(--space-3);width:100%">
              <div class="flip-card" data-id="1" style="height:80px;background:var(--accent-primary-subtle);border:2px solid var(--accent-primary);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-primary-text);cursor:default">1</div>
              <div class="flip-card" data-id="2" style="height:80px;background:var(--accent-gold-subtle);border:2px solid var(--accent-gold);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-gold-text);cursor:default">2</div>
              <div class="flip-card" data-id="3" style="height:80px;background:var(--accent-cyan-subtle);border:2px solid var(--accent-cyan);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-cyan-text);cursor:default">3</div>
              <div class="flip-card" data-id="4" style="height:80px;background:var(--accent-danger-subtle);border:2px solid var(--accent-danger);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-danger-text);cursor:default">4</div>
              <div class="flip-card" data-id="5" style="height:80px;background:var(--accent-green-subtle);border:2px solid var(--accent-green);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-green-text);cursor:default">5</div>
              <div class="flip-card" data-id="6" style="height:80px;background:var(--accent-purple-subtle);border:2px solid var(--accent-purple);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-purple-text);cursor:default">6</div>
              <div class="flip-card" data-id="7" style="height:80px;background:var(--accent-primary-subtle);border:2px solid var(--accent-primary);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-primary-text);cursor:default">7</div>
              <div class="flip-card" data-id="8" style="height:80px;background:var(--accent-gold-subtle);border:2px solid var(--accent-gold);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:var(--step-1);color:var(--accent-gold-text);cursor:default">8</div>
            </div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">card-shuffle</span>
              <button class="demo-btn" id="flip-shuffle-btn">Shuffle</button>
            </div>
            <p class="demo-card-desc">FLIP-animated card reordering. Records positions, shuffles DOM, then animates from old positions to new.</p>
            <p class="demo-card-hint">Click Shuffle to see FLIP in action</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         5. GESTURES & DRAG
         ================================================================ -->
    <section id="gestures" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-primary)"></span> Category 05</div>
        <h2 class="section-title">Gestures &amp; Drag</h2>
        <p class="section-desc">Unified pointer event handling for drag with inertia, snap points, and swipe gestures.</p>
      </div>

      <div class="demo-grid">
        <!-- Draggable Cards -->
        <div class="demo-card demo-card-wide">
          <div class="demo-card-stage" id="drag-stage" style="min-height:260px;cursor:grab">
            <div class="drag-card" style="
              position:absolute;left:60px;top:40px;width:100px;height:140px;
              background:var(--accent-primary-subtle);border:2px solid var(--accent-primary);
              border-radius:var(--radius-md);box-shadow:var(--shadow-md);
              display:flex;align-items:center;justify-content:center;
              font-weight:800;font-size:var(--step-2);color:var(--accent-primary-text);
              cursor:grab;user-select:none;touch-action:none;
            ">A</div>
            <div class="drag-card" style="
              position:absolute;left:200px;top:60px;width:100px;height:140px;
              background:var(--accent-gold-subtle);border:2px solid var(--accent-gold);
              border-radius:var(--radius-md);box-shadow:var(--shadow-md);
              display:flex;align-items:center;justify-content:center;
              font-weight:800;font-size:var(--step-2);color:var(--accent-gold-text);
              cursor:grab;user-select:none;touch-action:none;
            ">B</div>
            <div class="drag-card" style="
              position:absolute;left:340px;top:30px;width:100px;height:140px;
              background:var(--accent-cyan-subtle);border:2px solid var(--accent-cyan);
              border-radius:var(--radius-md);box-shadow:var(--shadow-md);
              display:flex;align-items:center;justify-content:center;
              font-weight:800;font-size:var(--step-2);color:var(--accent-cyan-text);
              cursor:grab;user-select:none;touch-action:none;
            ">C</div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">draggable-cards</span>
              <span class="tag">Gesture</span>
              <span class="tag">Inertia</span>
            </div>
            <p class="demo-card-desc">Drag cards with momentum. Release to see inertia carry the card forward, with spring-damped settling.</p>
            <p class="demo-card-hint">Drag the cards around</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         6. GENERATIVE ART
         ================================================================ -->
    <section id="generative" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-purple)"></span> Category 06</div>
        <h2 class="section-title">Generative Art</h2>
        <p class="section-desc">Algorithmic visuals driven by noise, recursion, and flow fields. Unique every time, always on-brand.</p>
      </div>

      <div class="demo-grid">
        <!-- Flow Field -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:280px">
            <canvas id="flowfield-canvas" aria-label="Flow field: noise-based particle flow creating organic patterns"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">flow-field</span>
              <span class="tag">Generative</span>
              <span class="tag">Noise</span>
            </div>
            <p class="demo-card-desc">Particles follow a Perlin noise flow field, creating organic, wind-like patterns colored by the token palette.</p>
            <p class="demo-card-hint">Watch the flow emerge</p>
          </div>
        </div>

        <!-- Fractal Tree -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:280px">
            <canvas id="fractal-canvas" aria-label="Recursive fractal tree that grows with animated branching"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">fractal-tree</span>
              <button class="demo-btn" id="fractal-regrow">Regrow</button>
            </div>
            <p class="demo-card-desc">Recursive L-system tree drawn with animated stroke. Each branch splits with slight random variation. Click Regrow for a new tree.</p>
            <p class="demo-card-hint">Click Regrow for a new variation</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         7. CURSOR & INTERACTIVE
         ================================================================ -->
    <section id="cursor" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-gold)"></span> Category 07</div>
        <h2 class="section-title">Cursor &amp; Interactive</h2>
        <p class="section-desc">Magnetic buttons, spotlight effects, 3D tilt cards, and ripple interactions that respond to your every move.</p>
      </div>

      <div class="demo-grid">
        <!-- Magnetic Buttons -->
        <div class="demo-card">
          <div class="demo-card-stage" id="magnetic-stage" style="display:flex;gap:var(--space-6);flex-wrap:wrap;justify-content:center">
            <button class="magnetic-btn" style="
              padding:var(--space-3) var(--space-8);font-family:var(--font-sans);
              font-size:var(--ui-text-md);font-weight:700;
              background:var(--accent-primary);color:var(--text-on-accent);
              border:2px solid var(--border-default);border-radius:var(--radius-sm);
              box-shadow:var(--shadow-md);cursor:pointer;
              transition:transform 0.2s ease-out;
            ">Hover Me</button>
            <button class="magnetic-btn" style="
              padding:var(--space-3) var(--space-8);font-family:var(--font-sans);
              font-size:var(--ui-text-md);font-weight:700;
              background:var(--accent-gold);color:var(--text-on-gold);
              border:2px solid var(--border-default);border-radius:var(--radius-sm);
              box-shadow:var(--shadow-md);cursor:pointer;
              transition:transform 0.2s ease-out;
            ">Attract</button>
            <button class="magnetic-btn" style="
              padding:var(--space-3) var(--space-8);font-family:var(--font-sans);
              font-size:var(--ui-text-md);font-weight:700;
              background:var(--accent-cyan);color:var(--text-on-accent);
              border:2px solid var(--border-default);border-radius:var(--radius-sm);
              box-shadow:var(--shadow-md);cursor:pointer;
              transition:transform 0.2s ease-out;
            ">Magnetic</button>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">magnetic-buttons</span>
              <span class="tag">Cursor</span>
            </div>
            <p class="demo-card-desc">Buttons that are attracted to your cursor when you hover nearby. The pull increases as you get closer.</p>
            <p class="demo-card-hint">Move cursor near the buttons</p>
          </div>
        </div>

        <!-- Tilt Cards -->
        <div class="demo-card">
          <div class="demo-card-stage" style="display:flex;gap:var(--space-4);flex-wrap:wrap;justify-content:center">
            <div class="tilt-card" style="
              width:140px;height:180px;
              background:var(--accent-primary-subtle);border:2px solid var(--accent-primary);
              border-radius:var(--radius-md);box-shadow:var(--shadow-md);
              display:flex;align-items:center;justify-content:center;
              font-weight:800;font-size:var(--step-2);color:var(--accent-primary-text);
              cursor:default;transition:box-shadow 0.3s ease;
            ">3D</div>
            <div class="tilt-card" style="
              width:140px;height:180px;
              background:var(--accent-gold-subtle);border:2px solid var(--accent-gold);
              border-radius:var(--radius-md);box-shadow:var(--shadow-md);
              display:flex;align-items:center;justify-content:center;
              font-weight:800;font-size:var(--step-2);color:var(--accent-gold-text);
              cursor:default;transition:box-shadow 0.3s ease;
            ">Tilt</div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">tilt-cards</span>
              <span class="tag">3D</span>
              <span class="tag">Perspective</span>
            </div>
            <p class="demo-card-desc">Cards respond to mouse position with 3D perspective rotation. Move your cursor across the card surface.</p>
            <p class="demo-card-hint">Hover over the cards</p>
          </div>
        </div>

        <!-- Ripple Effect -->
        <div class="demo-card">
          <div class="demo-card-stage" id="ripple-stage" style="cursor:pointer;min-height:200px">
            <span style="font-size:var(--ui-text-sm);color:var(--text-muted);pointer-events:none">Click anywhere</span>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">ripple-effect</span>
              <span class="tag">Click</span>
            </div>
            <p class="demo-card-desc">Material-style ripple effect on click. Ripple expands from click point with token-colored rings.</p>
            <p class="demo-card-hint">Click anywhere on the stage</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         8. SVG & MORPHING
         ================================================================ -->
    <section id="svg" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-cyan)"></span> Category 08</div>
        <h2 class="section-title">SVG &amp; Morphing</h2>
        <p class="section-desc">Shape transitions, gooey filters, and stroke animations using inline SVG and path manipulation.</p>
      </div>

      <div class="demo-grid">
        <!-- SVG Morph -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:220px">
            <svg id="morph-svg" viewBox="0 0 200 200" width="160" height="160">
              <path id="morph-path" d="M100,20 C140,20 180,60 180,100 C180,140 140,180 100,180 C60,180 20,140 20,100 C20,60 60,20 100,20 Z" fill="var(--accent-primary)" stroke="var(--border-default)" stroke-width="3"/>
            </svg>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">svg-morph</span>
              <button class="demo-btn" id="morph-toggle">Morph</button>
            </div>
            <p class="demo-card-desc">SVG path morphing between shapes: circle, star, square, and blob. Smooth interpolation between path data.</p>
            <p class="demo-card-hint">Click Morph to cycle shapes</p>
          </div>
        </div>

        <!-- Drawing Animation -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:220px">
            <svg id="draw-svg" viewBox="0 0 240 120" width="240" height="120">
              <path id="draw-path" d="M20,100 Q60,10 120,60 T220,20" fill="none" stroke="var(--accent-cyan)" stroke-width="3" stroke-linecap="round" stroke-dasharray="400" stroke-dashoffset="400"/>
              <circle id="draw-dot" cx="20" cy="100" r="5" fill="var(--accent-primary)" opacity="0"/>
            </svg>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">drawing-anim</span>
              <button class="demo-btn" id="draw-play">Draw</button>
            </div>
            <p class="demo-card-desc">Stroke-dasharray reveal animation. The path draws itself on screen with a leading dot that traces the curve.</p>
            <p class="demo-card-hint">Click Draw to animate</p>
          </div>
        </div>

        <!-- Gooey Button -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:220px">
            <svg width="0" height="0" style="position:absolute">
              <defs>
                <filter id="gooey-filter">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"/>
                  <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo"/>
                  <feComposite in="SourceGraphic" in2="goo" operator="atop"/>
                </filter>
              </defs>
            </svg>
            <div id="gooey-container" style="filter:url(#gooey-filter);display:flex;align-items:center;justify-content:center;position:relative;width:180px;height:64px">
              <div id="gooey-main" style="
                width:160px;height:56px;background:var(--accent-purple);
                border-radius:28px;display:flex;align-items:center;justify-content:center;
                font-weight:700;font-size:var(--ui-text-md);color:var(--text-on-accent);
                cursor:pointer;position:relative;z-index:2;user-select:none;
              ">Gooey</div>
              <div id="gooey-blob-1" style="width:40px;height:40px;background:var(--accent-purple);border-radius:50%;position:absolute;left:10px;top:12px;z-index:1;opacity:0"></div>
              <div id="gooey-blob-2" style="width:36px;height:36px;background:var(--accent-purple);border-radius:50%;position:absolute;right:10px;top:14px;z-index:1;opacity:0"></div>
            </div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">gooey-button</span>
              <span class="tag">SVG Filter</span>
            </div>
            <p class="demo-card-desc">SVG filter metaballs creating a liquid/gooey effect. Blobs merge and separate from the button on hover.</p>
            <p class="demo-card-hint">Hover over the button</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         9. SPLASHY & FUN
         ================================================================ -->
    <section id="splashy" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-primary)"></span> Category 09</div>
        <h2 class="section-title">Splashy &amp; Fun</h2>
        <p class="section-desc">Pure delight: emoji rain, aurora gradients, and digital waterfalls. Because a design system should make you smile.</p>
      </div>

      <div class="demo-grid">
        <!-- Emoji Rain -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px;overflow:hidden">
            <canvas id="emoji-canvas" aria-label="Emoji rain: cascading emojis falling like rain"></canvas>
            <button class="demo-btn" id="emoji-start" style="position:absolute;bottom:var(--space-3);left:50%;transform:translateX(-50%);z-index:2">Rain!</button>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">emoji-rain</span>
              <span class="tag">Fun</span>
            </div>
            <p class="demo-card-desc">Cascading emojis with rotation, varying sizes, and gentle swaying. Pure celebration.</p>
            <p class="demo-card-hint">Click Rain! to start</p>
          </div>
        </div>

        <!-- Matrix Rain -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px;background:oklch(0.14 0.012 60)">
            <canvas id="matrix-canvas" aria-label="Matrix digital rain: cascading characters in green"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">matrix-rain</span>
              <span class="tag">Fun</span>
              <span class="tag">Canvas</span>
            </div>
            <p class="demo-card-desc">Digital character cascade in the style of The Matrix. Uses token green for an on-brand digital rain.</p>
            <p class="demo-card-hint">Watch the characters fall</p>
          </div>
        </div>

        <!-- Aurora Gradient -->
        <div class="demo-card">
          <div class="demo-card-stage" style="min-height:240px">
            <canvas id="aurora-canvas" aria-label="Aurora gradient: animated mesh gradients creating nebula-like effects"></canvas>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">aurora-gradient</span>
              <span class="tag">Generative</span>
              <span class="tag">Gradient</span>
            </div>
            <p class="demo-card-desc">Animated mesh gradients using token colors to create shifting aurora/nebula effects. Soft, dreamy, organic.</p>
            <p class="demo-card-hint">Watch the colors shift</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================================================================
         10. COMBINED & ADVANCED
         ================================================================ -->
    <section id="combined" class="anim-section">
      <div class="section-header">
        <div class="section-overline"><span class="status-dot" style="background:var(--accent-green)"></span> Category 10</div>
        <h2 class="section-title">Combined &amp; Advanced</h2>
        <p class="section-desc">Multiple animation systems working in concert. The grand finale that showcases what token-driven JS animation can do.</p>
      </div>

      <div class="demo-grid">
        <!-- Spring + Confetti -->
        <div class="demo-card demo-card-wide">
          <div class="demo-card-stage" style="min-height:280px">
            <canvas id="combo-canvas" aria-label="Combined demo: spring button that fires confetti on click"></canvas>
            <div id="combo-btn" style="
              position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
              width:200px;height:64px;display:flex;align-items:center;justify-content:center;
              background:var(--accent-primary);color:var(--text-on-accent);
              border:2px solid var(--border-default);border-radius:var(--radius-sm);
              box-shadow:var(--shadow-lg);font-weight:800;font-size:var(--ui-text-lg);
              cursor:pointer;user-select:none;z-index:2;
            ">Celebrate!</div>
          </div>
          <div class="demo-card-body">
            <div class="demo-card-top">
              <span class="demo-card-name">spring-confetti</span>
              <span class="tag">Combined</span>
              <span class="tag">Spring</span>
              <span class="tag">Particles</span>
            </div>
            <p class="demo-card-desc">A spring-animated button that fires confetti on click. Combines the spring press effect with the particle cannon for a celebration moment.</p>
            <p class="demo-card-hint">Click Celebrate! for the full effect</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="ds-footer">
      <div class="hero-dots" style="margin-bottom:var(--space-4)">
        <span class="hero-dot" style="background:var(--accent-primary);width:8px;height:8px"></span>
        <span class="hero-dot" style="background:var(--accent-gold);width:8px;height:8px"></span>
        <span class="hero-dot" style="background:var(--accent-cyan);width:8px;height:8px"></span>
      </div>
      <p><strong>Delightful</strong> — Animation System</p>
      <p style="margin-top:var(--space-2)">Part of the <a href="delightful-design-system.html">Delightful Design System</a> &middot; <a href="delightful-motion.html">Motion System</a></p>
    </footer>

  </div><!-- .page-wrap -->

  <!-- Back to top -->
  <button class="back-to-top" id="back-to-top" aria-label="Back to top">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>

  <!-- Command palette -->
  <div class="cmd-palette-overlay" id="cmd-palette-overlay">
    <div class="cmd-palette" role="dialog" aria-label="Quick navigation">
      <input class="cmd-palette-input" id="cmd-palette-input" type="text" placeholder="Jump to section..." autocomplete="off" />
      <ul class="cmd-palette-list" id="cmd-palette-list" role="listbox"></ul>
    </div>
  </div>

  <script>
    /* ==========================================================================
       DELIGHTFUL ANIMATION — Core JavaScript
       ========================================================================== */
    (function() {
      'use strict';

      const html = document.documentElement;

      // ---- OKLCH to sRGB helper ----
      function oklchToRgb(L, C, H) {
        const hRad = H * Math.PI / 180;
        const a = C * Math.cos(hRad);
        const b = C * Math.sin(hRad);
        const l_ = L + 0.3963377774 * a + 0.2158037573 * b;
        const m_ = L - 0.1055613458 * a - 0.0638541728 * b;
        const s_ = L - 0.0894841775 * a - 1.2914855480 * b;
        const l3 = l_ * l_ * l_;
        const m3 = m_ * m_ * m_;
        const s3 = s_ * s_ * s_;
        let r = 4.0767416621 * l3 - 3.3077115913 * m3 + 0.2309699292 * s3;
        let g = -1.2684380046 * l3 + 2.6097574011 * m3 - 0.3413193965 * s3;
        let bl = -0.0041960863 * l3 - 0.7034186147 * m3 + 1.7076147010 * s3;
        const toSrgb = (x) => {
          x = Math.max(0, Math.min(1, x));
          return x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055;
        };
        return [
          Math.round(toSrgb(r) * 255),
          Math.round(toSrgb(g) * 255),
          Math.round(toSrgb(bl) * 255)
        ];
      }

      function oklchToHex(L, C, H) {
        const [r, g, b] = oklchToRgb(L, C, H);
        return '#' + [r, g, b].map(v => Math.max(0, Math.min(255, v)).toString(16).padStart(2, '0')).join('');
      }

      function oklchToRgba(L, C, H, A) {
        const [r, g, b] = oklchToRgb(L, C, H);
        return `rgba(${r},${g},${b},${A})`;
      }

      // ---- Parse token colors from computed styles ----
      function getTokenColors() {
        const style = getComputedStyle(document.documentElement);
        const parse = (val) => {
          const m = val.match(/oklch\(\s*([\d.]+)\s+([\d.]+)\s+([\d.]+)/);
          if (m) return { L: +m[1], C: +m[2], H: +m[3] };
          return null;
        };
        const get = (name) => {
          const raw = style.getPropertyValue(name).trim();
          const p = parse(raw);
          if (p) return oklchToHex(p.L, p.C, p.H);
          return '#888888';
        };
        return {
          primary: get('--accent-primary'),
          gold: get('--accent-gold'),
          cyan: get('--accent-cyan'),
          danger: get('--accent-danger'),
          green: get('--accent-green'),
          purple: get('--accent-purple'),
          text: get('--text-primary'),
          textSecondary: get('--text-secondary'),
          textMuted: get('--text-muted'),
          bgPage: get('--bg-page'),
          bgSurface: get('--bg-surface'),
          bgSubtle: get('--bg-subtle'),
          borderDefault: get('--border-default'),
        };
      }

      let colors = getTokenColors();

      // ---- Theme toggle (3-way: light -> dark -> system) ----
      const prefersDarkMq = window.matchMedia('(prefers-color-scheme: dark)');
      const savedMode = localStorage.getItem('delightful-theme-mode') || localStorage.getItem('delightful-theme') || 'system';

      function applyThemeMode(mode) {
        if (mode === 'system') {
          html.setAttribute('data-theme', prefersDarkMq.matches ? 'dark' : 'light');
          html.setAttribute('data-theme-mode', 'system');
          localStorage.setItem('delightful-theme-mode', 'system');
          localStorage.removeItem('delightful-theme');
        } else {
          html.setAttribute('data-theme', mode);
          html.removeAttribute('data-theme-mode');
          localStorage.setItem('delightful-theme-mode', mode);
          localStorage.setItem('delightful-theme', mode);
        }
        colors = getTokenColors();
      }

      applyThemeMode(savedMode === 'light' || savedMode === 'dark' ? savedMode : 'system');

      prefersDarkMq.addEventListener('change', () => {
        if (html.getAttribute('data-theme-mode') === 'system') {
          html.setAttribute('data-theme', prefersDarkMq.matches ? 'dark' : 'light');
          colors = getTokenColors();
        }
      });

      document.getElementById('theme-toggle').addEventListener('click', () => {
        const current = localStorage.getItem('delightful-theme-mode') || 'system';
        const next = current === 'light' ? 'dark' : current === 'dark' ? 'system' : 'light';
        if (document.startViewTransition) {
          document.startViewTransition(() => applyThemeMode(next));
        } else {
          applyThemeMode(next);
        }
      });

      // ---- Back to top ----
      const backToTop = document.getElementById('back-to-top');
      const heroEl = document.querySelector('.hero');
      if (backToTop && heroEl) {
        const obs = new IntersectionObserver(([entry]) => {
          backToTop.classList.toggle('visible', !entry.isIntersecting);
        }, { threshold: 0 });
        obs.observe(heroEl);
        backToTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
      }

      // ---- Command palette ----
      const cmdSections = [
        { id: 'springs', label: 'Spring Physics', color: 'var(--accent-primary)' },
        { id: 'particles', label: 'Particle Systems', color: 'var(--accent-gold)' },
        { id: 'physics', label: 'Physics Playground', color: 'var(--accent-cyan)' },
        { id: 'flip', label: 'FLIP & Layout', color: 'var(--accent-green)' },
        { id: 'gestures', label: 'Gestures & Drag', color: 'var(--accent-primary)' },
        { id: 'generative', label: 'Generative Art', color: 'var(--accent-purple)' },
        { id: 'cursor', label: 'Cursor & Interactive', color: 'var(--accent-gold)' },
        { id: 'svg', label: 'SVG & Morphing', color: 'var(--accent-cyan)' },
        { id: 'splashy', label: 'Splashy & Fun', color: 'var(--accent-primary)' },
        { id: 'combined', label: 'Combined & Advanced', color: 'var(--accent-green)' },
      ];
      const cmdOverlay = document.getElementById('cmd-palette-overlay');
      const cmdInput = document.getElementById('cmd-palette-input');
      const cmdList = document.getElementById('cmd-palette-list');
      let cmdActiveIdx = 0;

      function renderCmdList(filter) {
        const q = (filter || '').toLowerCase();
        const filtered = cmdSections.filter(s => s.label.toLowerCase().includes(q) || s.id.includes(q));
        cmdList.innerHTML = '';
        if (!filtered.length) {
          cmdList.innerHTML = '<li class="cmd-palette-empty">No sections found</li>';
          return;
        }
        filtered.forEach((s, i) => {
          const li = document.createElement('li');
          li.className = 'cmd-palette-item' + (i === 0 ? ' active' : '');
          li.setAttribute('role', 'option');
          li.dataset.sectionId = s.id;
          li.innerHTML = '<span class="cmd-section-dot" style="background:' + s.color + '"></span>' + s.label;
          li.addEventListener('click', () => navigateToSection(s.id));
          li.addEventListener('mouseenter', () => {
            cmdList.querySelectorAll('.cmd-palette-item').forEach(el => el.classList.remove('active'));
            li.classList.add('active');
            cmdActiveIdx = i;
          });
          cmdList.appendChild(li);
        });
        cmdActiveIdx = 0;
      }

      function navigateToSection(id) {
        closeCmdPalette();
        const el = document.getElementById(id);
        if (el) el.scrollIntoView({ behavior: 'smooth' });
      }

      function openCmdPalette() {
        cmdOverlay.classList.add('active');
        cmdInput.value = '';
        renderCmdList('');
        setTimeout(() => cmdInput.focus(), 50);
      }

      function closeCmdPalette() {
        cmdOverlay.classList.remove('active');
      }

      document.getElementById('cmd-k-trigger').addEventListener('click', openCmdPalette);
      cmdOverlay.addEventListener('click', (e) => { if (e.target === cmdOverlay) closeCmdPalette(); });
      cmdInput.addEventListener('input', () => renderCmdList(cmdInput.value));
      cmdInput.addEventListener('keydown', (e) => {
        const items = cmdList.querySelectorAll('.cmd-palette-item');
        if (e.key === 'Escape') { closeCmdPalette(); return; }
        if (e.key === 'ArrowDown') { e.preventDefault(); cmdActiveIdx = Math.min(cmdActiveIdx + 1, items.length - 1); }
        if (e.key === 'ArrowUp') { e.preventDefault(); cmdActiveIdx = Math.max(cmdActiveIdx - 1, 0); }
        if (e.key === 'Enter' && items[cmdActiveIdx]) {
          navigateToSection(items[cmdActiveIdx].dataset.sectionId);
          return;
        }
        items.forEach((el, i) => el.classList.toggle('active', i === cmdActiveIdx));
      });
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          cmdOverlay.classList.contains('active') ? closeCmdPalette() : openCmdPalette();
        }
        if (e.key === 'Escape' && cmdOverlay.classList.contains('active')) closeCmdPalette();
      });

      // ---- Hero particle constellation ----
      const heroCanvas = document.getElementById('hero-canvas');
      if (heroCanvas) {
        const ctx = heroCanvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        let W, H;
        const PARTICLE_COUNT = 60;
        const CONNECTION_DIST = 120;
        const particles = [];
        let mouseX = -1000, mouseY = -1000;
        let heroAnimId = null;

        function resizeHeroCanvas() {
          const rect = heroCanvas.parentElement.getBoundingClientRect();
          W = rect.width;
          H = rect.height;
          heroCanvas.width = W * dpr;
          heroCanvas.height = H * dpr;
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        function initParticles() {
          particles.length = 0;
          const palette = [colors.primary, colors.gold, colors.cyan, colors.danger, colors.green, colors.purple];
          for (let i = 0; i < PARTICLE_COUNT; i++) {
            particles.push({
              x: Math.random() * W,
              y: Math.random() * H,
              vx: (Math.random() - 0.5) * 0.8,
              vy: (Math.random() - 0.5) * 0.8,
              r: 3 + Math.random() * 4,
              color: palette[i % palette.length],
            });
          }
        }

        function drawHero() {
          ctx.clearRect(0, 0, W, H);

          // Connections
          for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
              const dx = particles[i].x - particles[j].x;
              const dy = particles[i].y - particles[j].y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              if (dist < CONNECTION_DIST) {
                const alpha = 1 - dist / CONNECTION_DIST;
                ctx.beginPath();
                ctx.moveTo(particles[i].x, particles[i].y);
                ctx.lineTo(particles[j].x, particles[j].y);
                ctx.strokeStyle = colors.borderDefault + Math.round(alpha * 40).toString(16).padStart(2, '0');
                ctx.lineWidth = 1;
                ctx.stroke();
              }
            }
          }

          // Particles
          for (const p of particles) {
            // Mouse attraction
            const dx = mouseX - p.x;
            const dy = mouseY - p.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 150 && dist > 1) {
              p.vx += dx / dist * 0.15;
              p.vy += dy / dist * 0.15;
            }

            // Damping
            p.vx *= 0.98;
            p.vy *= 0.98;

            p.x += p.vx;
            p.y += p.vy;

            // Wrap edges
            if (p.x < -10) p.x = W + 10;
            if (p.x > W + 10) p.x = -10;
            if (p.y < -10) p.y = H + 10;
            if (p.y > H + 10) p.y = -10;

            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            ctx.strokeStyle = colors.borderDefault;
            ctx.lineWidth = 1.5;
            ctx.stroke();
          }

          heroAnimId = requestAnimationFrame(drawHero);
        }

        function handleHeroPointer(e) {
          const rect = heroCanvas.getBoundingClientRect();
          if (e.touches) {
            mouseX = e.touches[0].clientX - rect.left;
            mouseY = e.touches[0].clientY - rect.top;
          } else {
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
          }
        }

        heroCanvas.addEventListener('mousemove', handleHeroPointer);
        heroCanvas.addEventListener('touchmove', handleHeroPointer, { passive: true });
        heroCanvas.addEventListener('mouseleave', () => { mouseX = -1000; mouseY = -1000; });

        // Click creates gravity well burst
        heroCanvas.addEventListener('click', (e) => {
          const rect = heroCanvas.getBoundingClientRect();
          const cx = e.clientX - rect.left;
          const cy = e.clientY - rect.top;
          for (const p of particles) {
            const dx = p.x - cx;
            const dy = p.y - cy;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 200 && dist > 1) {
              const force = (200 - dist) / 200 * 3;
              p.vx += (dx / dist) * force;
              p.vy += (dy / dist) * force;
            }
          }
        });

        // Lazy init hero with IntersectionObserver
        const heroObs = new IntersectionObserver(([entry]) => {
          if (entry.isIntersecting) {
            if (!heroAnimId) {
              resizeHeroCanvas();
              if (!particles.length) initParticles();
              drawHero();
            }
          } else {
            if (heroAnimId) {
              cancelAnimationFrame(heroAnimId);
              heroAnimId = null;
            }
          }
        }, { threshold: 0.1 });
        heroObs.observe(heroCanvas.parentElement);

        window.addEventListener('resize', () => {
          resizeHeroCanvas();
          if (!particles.length) initParticles();
        });

        // Reduced motion: show static frame
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          resizeHeroCanvas();
          initParticles();
          drawHero();
          cancelAnimationFrame(heroAnimId);
          heroAnimId = null;
        }
      }

      // ================================================================
      //  SPRING SOLVER
      // ================================================================
      function springStep(state, config, dt) {
        // Damped harmonic oscillator: F = -kx - cv
        const { stiffness, damping, mass } = config;
        const springForce = -stiffness * (state.value - state.target);
        const dampingForce = -damping * state.velocity;
        const acceleration = (springForce + dampingForce) / mass;
        state.velocity += acceleration * dt;
        state.value += state.velocity * dt;
      }

      // ================================================================
      //  ANIMATION MANAGER — single rAF loop
      // ================================================================
      const animations = new Map();
      let globalAnimId = null;
      const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function registerAnimation(key, updateFn) {
        animations.set(key, { update: updateFn, active: false });
      }

      function activateAnimation(key) {
        const a = animations.get(key);
        if (a) a.active = true;
        if (!globalAnimId) globalLoop();
      }

      function deactivateAnimation(key) {
        const a = animations.get(key);
        if (a) a.active = false;
      }

      let lastTime = 0;
      function globalLoop(now) {
        if (!now) now = performance.now();
        const dt = Math.min((now - lastTime) / 1000, 0.05);
        lastTime = now;

        let anyActive = false;
        animations.forEach((a) => {
          if (a.active) {
            a.update(dt, now);
            anyActive = true;
          }
        });

        if (anyActive) {
          globalAnimId = requestAnimationFrame(globalLoop);
        } else {
          globalAnimId = null;
        }
      }

      // ================================================================
      //  INTERSECTION OBSERVER for lazy activation
      // ================================================================
      function observeCanvas(canvasOrParent, key, initFn) {
        let initialized = false;
        const obs = new IntersectionObserver(([entry]) => {
          if (entry.isIntersecting) {
            if (!initialized) { initFn(); initialized = true; }
            activateAnimation(key);
          } else {
            deactivateAnimation(key);
          }
        }, { threshold: 0.05 });
        obs.observe(canvasOrParent);
      }

      // ================================================================
      //  Canvas resize helper
      // ================================================================
      function setupCanvas(canvas) {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.parentElement.getBoundingClientRect();
        const w = rect.width;
        const h = rect.height;
        canvas.width = w * dpr;
        canvas.height = h * dpr;
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        const ctx = canvas.getContext('2d');
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        return { ctx, w, h, dpr };
      }

      // ================================================================
      //  1. SPRING BUTTON
      // ================================================================
      (function() {
        const stage = document.getElementById('spring-btn-stage');
        const el = document.getElementById('spring-btn-el');
        if (!stage || !el) return;

        const state = { value: 1, velocity: 0, target: 1 };
        const config = { stiffness: 300, damping: 15, mass: 1 };
        let pressing = false;

        registerAnimation('spring-btn', (dt) => {
          springStep(state, config, dt);
          el.style.transform = `scale(${state.value})`;
          if (Math.abs(state.value - state.target) < 0.001 && Math.abs(state.velocity) < 0.01) {
            state.value = state.target;
            el.style.transform = `scale(${state.target})`;
            if (!pressing) deactivateAnimation('spring-btn');
          }
        });

        stage.addEventListener('pointerdown', (e) => {
          pressing = true;
          state.target = 0.85;
          activateAnimation('spring-btn');
        });
        stage.addEventListener('pointerup', () => {
          pressing = false;
          state.target = 1;
          activateAnimation('spring-btn');
        });
        stage.addEventListener('pointerleave', () => {
          if (pressing) {
            pressing = false;
            state.target = 1;
            activateAnimation('spring-btn');
          }
        });
      })();

      // ================================================================
      //  1b. SPRING CHAIN
      // ================================================================
      (function() {
        const canvas = document.getElementById('spring-chain-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const NODES = 8;
        const nodes = [];
        let mx = 0, my = 0;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          nodes.length = 0;
          const palette = [colors.primary, colors.gold, colors.cyan, colors.danger, colors.green, colors.purple, colors.primary, colors.gold];
          for (let i = 0; i < NODES; i++) {
            nodes.push({ x: w / 2, y: h / 2, vx: 0, vy: 0, color: palette[i % palette.length] });
          }
          mx = w / 2; my = h / 2;
        }

        canvas.parentElement.addEventListener('mousemove', (e) => {
          const rect = canvas.getBoundingClientRect();
          mx = e.clientX - rect.left;
          my = e.clientY - rect.top;
        });
        canvas.parentElement.addEventListener('mouseleave', () => { mx = w / 2; my = h / 2; });

        registerAnimation('spring-chain', (dt) => {
          ctx.clearRect(0, 0, w, h);
          // Leader follows mouse
          const leader = nodes[0];
          const stiffness = 120, damping = 12;
          leader.vx += (mx - leader.x) * stiffness * dt - leader.vx * damping * dt;
          leader.vy += (my - leader.y) * stiffness * dt - leader.vy * damping * dt;
          leader.x += leader.vx * dt;
          leader.y += leader.vy * dt;

          // Followers
          for (let i = 1; i < NODES; i++) {
            const prev = nodes[i - 1];
            const node = nodes[i];
            const s = 80 - i * 5;
            const d = 10 + i;
            node.vx += (prev.x - node.x) * s * dt - node.vx * d * dt;
            node.vy += (prev.y - node.y) * s * dt - node.vy * d * dt;
            node.x += node.vx * dt;
            node.y += node.vy * dt;
          }

          // Draw connections
          ctx.beginPath();
          ctx.moveTo(nodes[0].x, nodes[0].y);
          for (let i = 1; i < NODES; i++) {
            ctx.lineTo(nodes[i].x, nodes[i].y);
          }
          ctx.strokeStyle = colors.borderDefault + '40';
          ctx.lineWidth = 2;
          ctx.stroke();

          // Draw nodes
          for (let i = NODES - 1; i >= 0; i--) {
            const r = 14 - i;
            ctx.beginPath();
            ctx.arc(nodes[i].x, nodes[i].y, r, 0, Math.PI * 2);
            ctx.fillStyle = nodes[i].color;
            ctx.fill();
            ctx.strokeStyle = colors.borderDefault;
            ctx.lineWidth = 2;
            ctx.stroke();
          }
        });

        observeCanvas(canvas.parentElement, 'spring-chain', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  1c. SPRING PARAMETERS PLAYGROUND
      // ================================================================
      (function() {
        const canvas = document.getElementById('spring-params-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const ball = { value: 0.15, velocity: 0, target: 0.15 };
        const ballY = { value: 0.5, velocity: 0, target: 0.5 };
        const trail = [];

        const stiffnessSlider = document.getElementById('spring-stiffness');
        const dampingSlider = document.getElementById('spring-damping');
        const massSlider = document.getElementById('spring-mass');
        const stiffnessVal = document.getElementById('spring-stiffness-val');
        const dampingVal = document.getElementById('spring-damping-val');
        const massVal = document.getElementById('spring-mass-val');

        stiffnessSlider.addEventListener('input', () => { stiffnessVal.textContent = stiffnessSlider.value; });
        dampingSlider.addEventListener('input', () => { dampingVal.textContent = dampingSlider.value; });
        massSlider.addEventListener('input', () => { massVal.textContent = (+massSlider.value).toFixed(1); });

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          ball.value = 0.15; ball.target = 0.85;
          ballY.value = 0.5; ballY.target = 0.5;
          trail.length = 0;
        }

        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          ball.target = (e.clientX - rect.left) / rect.width;
          ballY.target = (e.clientY - rect.top) / rect.height;
          ball.velocity = 0;
          ballY.velocity = 0;
          trail.length = 0;
        });

        registerAnimation('spring-params', (dt) => {
          const config = {
            stiffness: +stiffnessSlider.value,
            damping: +dampingSlider.value,
            mass: +massSlider.value,
          };
          springStep(ball, config, dt);
          springStep(ballY, config, dt);

          // Track trail
          trail.push({ x: ball.value * w, y: ballY.value * h });
          if (trail.length > 80) trail.shift();

          ctx.clearRect(0, 0, w, h);

          // Draw target
          ctx.beginPath();
          ctx.arc(ball.target * w, ballY.target * h, 20, 0, Math.PI * 2);
          ctx.strokeStyle = colors.borderDefault + '30';
          ctx.lineWidth = 2;
          ctx.setLineDash([4, 4]);
          ctx.stroke();
          ctx.setLineDash([]);

          // Draw trail
          if (trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(trail[0].x, trail[0].y);
            for (let i = 1; i < trail.length; i++) {
              ctx.lineTo(trail[i].x, trail[i].y);
            }
            ctx.strokeStyle = colors.primary + '40';
            ctx.lineWidth = 2;
            ctx.stroke();
          }

          // Draw ball
          const bx = ball.value * w;
          const by = ballY.value * h;
          ctx.beginPath();
          ctx.arc(bx, by, 16, 0, Math.PI * 2);
          ctx.fillStyle = colors.primary;
          ctx.fill();
          ctx.strokeStyle = colors.borderDefault;
          ctx.lineWidth = 2;
          ctx.stroke();
        });

        observeCanvas(canvas.parentElement, 'spring-params', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  2a. CONFETTI CANNON
      // ================================================================
      (function() {
        const canvas = document.getElementById('confetti-canvas');
        const fireBtn = document.getElementById('confetti-fire');
        if (!canvas) return;

        let ctx, w, h;
        const POOL_SIZE = 200;
        const pool = [];
        let activeCount = 0;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          pool.length = 0;
          activeCount = 0;
          for (let i = 0; i < POOL_SIZE; i++) {
            pool.push({ active: false, x: 0, y: 0, vx: 0, vy: 0, r: 0, color: '', life: 0, maxLife: 0, rotation: 0, rotSpeed: 0, shape: 0 });
          }
        }

        function emit(cx, cy, count) {
          const palette = [colors.primary, colors.gold, colors.cyan, colors.danger, colors.green, colors.purple];
          for (let i = 0; i < count && activeCount < POOL_SIZE; i++) {
            const p = pool.find(pp => !pp.active);
            if (!p) break;
            p.active = true;
            p.x = cx;
            p.y = cy;
            const angle = -Math.PI / 2 + (Math.random() - 0.5) * 1.2;
            const speed = 200 + Math.random() * 400;
            p.vx = Math.cos(angle) * speed;
            p.vy = Math.sin(angle) * speed;
            p.r = 3 + Math.random() * 5;
            p.color = palette[Math.floor(Math.random() * palette.length)];
            p.life = 0;
            p.maxLife = 1.5 + Math.random() * 1.5;
            p.rotation = Math.random() * Math.PI * 2;
            p.rotSpeed = (Math.random() - 0.5) * 10;
            p.shape = Math.floor(Math.random() * 3);
            activeCount++;
          }
          activateAnimation('confetti');
        }

        if (fireBtn) fireBtn.addEventListener('click', (e) => { e.stopPropagation(); emit(w / 2, h * 0.8, 50); });
        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          emit(e.clientX - rect.left, e.clientY - rect.top, 40);
        });

        registerAnimation('confetti', (dt) => {
          ctx.clearRect(0, 0, w, h);
          activeCount = 0;
          for (const p of pool) {
            if (!p.active) continue;
            p.life += dt;
            if (p.life > p.maxLife) { p.active = false; continue; }
            activeCount++;
            p.vy += 400 * dt; // gravity
            p.vx *= 0.99;
            p.x += p.vx * dt;
            p.y += p.vy * dt;
            p.rotation += p.rotSpeed * dt;
            const alpha = 1 - p.life / p.maxLife;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation);
            ctx.globalAlpha = alpha;
            ctx.fillStyle = p.color;
            if (p.shape === 0) {
              ctx.fillRect(-p.r, -p.r / 3, p.r * 2, p.r * 0.66);
            } else if (p.shape === 1) {
              ctx.beginPath(); ctx.arc(0, 0, p.r / 2, 0, Math.PI * 2); ctx.fill();
            } else {
              ctx.beginPath();
              ctx.moveTo(0, -p.r); ctx.lineTo(p.r * 0.7, p.r * 0.5); ctx.lineTo(-p.r * 0.7, p.r * 0.5);
              ctx.fill();
            }
            ctx.restore();
          }
          if (activeCount === 0) deactivateAnimation('confetti');
        });

        observeCanvas(canvas.parentElement, 'confetti', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  2b. FIREWORKS
      // ================================================================
      (function() {
        const canvas = document.getElementById('fireworks-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const rockets = [];
        const sparks = [];

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          rockets.length = 0; sparks.length = 0;
        }

        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          const tx = e.clientX - rect.left;
          const ty = e.clientY - rect.top;
          rockets.push({ x: w / 2, y: h, tx, ty, vy: -400 - Math.random() * 200, vx: (tx - w / 2) * 0.5, life: 0, color: [colors.primary, colors.gold, colors.cyan, colors.purple][Math.floor(Math.random() * 4)] });
          activateAnimation('fireworks');
        });

        registerAnimation('fireworks', (dt) => {
          ctx.fillStyle = colors.bgPage + '18';
          ctx.fillRect(0, 0, w, h);

          // Rockets
          for (let i = rockets.length - 1; i >= 0; i--) {
            const r = rockets[i];
            r.x += r.vx * dt;
            r.y += r.vy * dt;
            r.vy += 150 * dt;
            r.life += dt;

            ctx.beginPath();
            ctx.arc(r.x, r.y, 3, 0, Math.PI * 2);
            ctx.fillStyle = r.color;
            ctx.fill();

            if (r.vy > 0 || r.life > 2) {
              // Explode
              const count = 40 + Math.floor(Math.random() * 30);
              for (let j = 0; j < count; j++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 60 + Math.random() * 180;
                sparks.push({ x: r.x, y: r.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, life: 0, maxLife: 0.8 + Math.random() * 0.8, color: r.color, r: 2 + Math.random() * 2 });
              }
              rockets.splice(i, 1);
            }
          }

          // Sparks
          for (let i = sparks.length - 1; i >= 0; i--) {
            const s = sparks[i];
            s.life += dt;
            if (s.life > s.maxLife) { sparks.splice(i, 1); continue; }
            s.vy += 120 * dt;
            s.vx *= 0.98;
            s.x += s.vx * dt;
            s.y += s.vy * dt;
            const alpha = 1 - s.life / s.maxLife;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.r * alpha, 0, Math.PI * 2);
            ctx.fillStyle = s.color;
            ctx.globalAlpha = alpha;
            ctx.fill();
            ctx.globalAlpha = 1;
          }

          if (rockets.length === 0 && sparks.length === 0) deactivateAnimation('fireworks');
        });

        observeCanvas(canvas.parentElement, 'fireworks', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  2c. PARTICLE TEXT
      // ================================================================
      (function() {
        const canvas = document.getElementById('particle-text-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const particles = [];
        let mx = -1000, my = -1000;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          particles.length = 0;

          // Draw text offscreen to sample pixels
          const offscreen = document.createElement('canvas');
          offscreen.width = w; offscreen.height = h;
          const offCtx = offscreen.getContext('2d');
          const fontSize = Math.min(w / 5, 60);
          offCtx.fillStyle = '#000';
          offCtx.font = `900 ${fontSize}px Inter, sans-serif`;
          offCtx.textAlign = 'center';
          offCtx.textBaseline = 'middle';
          offCtx.fillText('DELIGHTFUL', w / 2, h / 2);

          const imageData = offCtx.getImageData(0, 0, w, h).data;
          const gap = 4;
          const palette = [colors.primary, colors.gold, colors.cyan, colors.green, colors.purple];
          let ci = 0;
          for (let y = 0; y < h; y += gap) {
            for (let x = 0; x < w; x += gap) {
              const idx = (y * w + x) * 4;
              if (imageData[idx + 3] > 128) {
                particles.push({
                  homeX: x, homeY: y,
                  x, y,
                  vx: 0, vy: 0,
                  color: palette[ci++ % palette.length],
                });
              }
            }
          }
        }

        canvas.parentElement.addEventListener('mousemove', (e) => {
          const rect = canvas.getBoundingClientRect();
          mx = e.clientX - rect.left;
          my = e.clientY - rect.top;
        });
        canvas.parentElement.addEventListener('mouseleave', () => { mx = -1000; my = -1000; });

        registerAnimation('particle-text', (dt) => {
          ctx.clearRect(0, 0, w, h);
          for (const p of particles) {
            const dx = mx - p.x;
            const dy = my - p.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const repelRadius = 60;

            if (dist < repelRadius && dist > 0) {
              const force = (repelRadius - dist) / repelRadius * 8;
              p.vx -= (dx / dist) * force;
              p.vy -= (dy / dist) * force;
            }

            // Spring back to home
            p.vx += (p.homeX - p.x) * 4 * dt;
            p.vy += (p.homeY - p.y) * 4 * dt;
            p.vx *= 0.9;
            p.vy *= 0.9;
            p.x += p.vx;
            p.y += p.vy;

            ctx.fillStyle = p.color;
            ctx.fillRect(p.x - 1.5, p.y - 1.5, 3, 3);
          }
        });

        observeCanvas(canvas.parentElement, 'particle-text', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  2d. STAR FIELD
      // ================================================================
      (function() {
        const canvas = document.getElementById('starfield-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const stars = [];
        const STAR_COUNT = 150;
        let mx = 0.5, my = 0.5;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          stars.length = 0;
          for (let i = 0; i < STAR_COUNT; i++) {
            stars.push({
              x: Math.random() * w,
              y: Math.random() * h,
              z: Math.random() * 3 + 0.5,
              size: Math.random() * 2 + 0.5,
            });
          }
        }

        canvas.parentElement.addEventListener('mousemove', (e) => {
          const rect = canvas.getBoundingClientRect();
          mx = (e.clientX - rect.left) / rect.width;
          my = (e.clientY - rect.top) / rect.height;
        });

        registerAnimation('starfield', (dt) => {
          ctx.fillStyle = '#1a1a1a';
          ctx.fillRect(0, 0, w, h);
          const speed = 200;
          const steerX = (mx - 0.5) * 100;
          const steerY = (my - 0.5) * 50;

          for (const s of stars) {
            s.x -= (speed * s.z + steerX * s.z) * dt;
            s.y -= steerY * s.z * dt;

            if (s.x < 0) { s.x = w; s.y = Math.random() * h; }
            if (s.x > w) { s.x = 0; s.y = Math.random() * h; }
            if (s.y < 0) s.y = h;
            if (s.y > h) s.y = 0;

            const alpha = Math.min(s.z / 3, 1);
            const streakLen = s.z * 4;
            ctx.beginPath();
            ctx.moveTo(s.x, s.y);
            ctx.lineTo(s.x + streakLen, s.y);
            ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
            ctx.lineWidth = s.size;
            ctx.stroke();
          }
        });

        observeCanvas(canvas.parentElement, 'starfield', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  3a. GRAVITY BALLS
      // ================================================================
      (function() {
        const canvas = document.getElementById('gravity-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const balls = [];

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          balls.length = 0;
        }

        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          const palette = [colors.primary, colors.gold, colors.cyan, colors.danger, colors.green, colors.purple];
          balls.push({
            x: e.clientX - rect.left,
            y: e.clientY - rect.top,
            vx: (Math.random() - 0.5) * 100,
            vy: 0,
            r: 10 + Math.random() * 20,
            color: palette[Math.floor(Math.random() * palette.length)],
            restitution: 0.5 + Math.random() * 0.35,
          });
          if (balls.length > 30) balls.shift();
          activateAnimation('gravity');
        });

        registerAnimation('gravity', (dt) => {
          ctx.clearRect(0, 0, w, h);
          const gravity = 600;
          let moving = false;

          for (const b of balls) {
            b.vy += gravity * dt;
            b.x += b.vx * dt;
            b.y += b.vy * dt;

            // Floor
            if (b.y + b.r > h) {
              b.y = h - b.r;
              b.vy = -b.vy * b.restitution;
              if (Math.abs(b.vy) < 10) b.vy = 0;
            }
            // Walls
            if (b.x - b.r < 0) { b.x = b.r; b.vx = Math.abs(b.vx) * b.restitution; }
            if (b.x + b.r > w) { b.x = w - b.r; b.vx = -Math.abs(b.vx) * b.restitution; }

            b.vx *= 0.999;

            if (Math.abs(b.vx) > 0.5 || Math.abs(b.vy) > 0.5 || b.y + b.r < h - 1) moving = true;

            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
            ctx.fillStyle = b.color;
            ctx.fill();
            ctx.strokeStyle = colors.borderDefault;
            ctx.lineWidth = 2;
            ctx.stroke();
          }

          // Draw ground line
          ctx.beginPath();
          ctx.moveTo(0, h - 1);
          ctx.lineTo(w, h - 1);
          ctx.strokeStyle = colors.borderDefault + '40';
          ctx.lineWidth = 2;
          ctx.stroke();

          if (!moving && balls.length > 0) deactivateAnimation('gravity');
        });

        observeCanvas(canvas.parentElement, 'gravity', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  3b. VERLET CLOTH
      // ================================================================
      (function() {
        const canvas = document.getElementById('cloth-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const cols = 20, rows = 14;
        const spacing = 18;
        let points = [];
        let sticks = [];
        let dragPoint = null;
        let mx = 0, my = 0, dragging = false;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          points = []; sticks = [];
          const startX = (w - cols * spacing) / 2;
          const startY = 20;

          for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
              const px = startX + x * spacing;
              const py = startY + y * spacing;
              points.push({ x: px, y: py, oldX: px, oldY: py, pinned: y === 0 });
            }
          }

          for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
              const i = y * cols + x;
              if (x < cols - 1) sticks.push({ a: i, b: i + 1, len: spacing });
              if (y < rows - 1) sticks.push({ a: i, b: i + cols, len: spacing });
            }
          }
        }

        canvas.addEventListener('pointerdown', (e) => {
          const rect = canvas.getBoundingClientRect();
          mx = e.clientX - rect.left;
          my = e.clientY - rect.top;
          dragging = true;
          // Find nearest
          let minDist = 30, best = null;
          for (const p of points) {
            const d = Math.sqrt((p.x - mx) ** 2 + (p.y - my) ** 2);
            if (d < minDist) { minDist = d; best = p; }
          }
          dragPoint = best;
        });
        canvas.addEventListener('pointermove', (e) => {
          const rect = canvas.getBoundingClientRect();
          mx = e.clientX - rect.left;
          my = e.clientY - rect.top;
        });
        canvas.addEventListener('pointerup', () => { dragging = false; dragPoint = null; });

        registerAnimation('cloth', (dt) => {
          // Verlet integration
          const gravity = 600;
          for (const p of points) {
            if (p.pinned) continue;
            const vx = p.x - p.oldX;
            const vy = p.y - p.oldY;
            p.oldX = p.x;
            p.oldY = p.y;
            p.x += vx * 0.99;
            p.y += vy * 0.99 + gravity * dt * dt;
          }

          if (dragging && dragPoint && !dragPoint.pinned) {
            dragPoint.x = mx;
            dragPoint.y = my;
          }

          // Constraint satisfaction
          for (let iter = 0; iter < 5; iter++) {
            for (const s of sticks) {
              const a = points[s.a];
              const b = points[s.b];
              const dx = b.x - a.x;
              const dy = b.y - a.y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              if (dist === 0) continue;
              const diff = (dist - s.len) / dist * 0.5;
              if (!a.pinned) { a.x += dx * diff; a.y += dy * diff; }
              if (!b.pinned) { b.x -= dx * diff; b.y -= dy * diff; }
            }
          }

          // Draw
          ctx.clearRect(0, 0, w, h);
          ctx.strokeStyle = colors.primary + '60';
          ctx.lineWidth = 1;
          for (const s of sticks) {
            const a = points[s.a];
            const b = points[s.b];
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            ctx.stroke();
          }
          for (const p of points) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.pinned ? 4 : 2, 0, Math.PI * 2);
            ctx.fillStyle = p.pinned ? colors.danger : colors.primary;
            ctx.fill();
          }
        });

        observeCanvas(canvas.parentElement, 'cloth', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  4. FLIP CARD SHUFFLE
      // ================================================================
      (function() {
        const grid = document.getElementById('flip-grid');
        const btn = document.getElementById('flip-shuffle-btn');
        if (!grid || !btn) return;

        btn.addEventListener('click', () => {
          const cards = [...grid.children];
          // FIRST: record positions
          const firstRects = cards.map(c => c.getBoundingClientRect());

          // Shuffle DOM
          for (let i = cards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            grid.appendChild(cards[j]);
          }

          // LAST: get new positions
          const shuffled = [...grid.children];
          shuffled.forEach((card, i) => {
            const oldIdx = cards.indexOf(card);
            const first = firstRects[oldIdx];
            const last = card.getBoundingClientRect();

            // INVERT
            const dx = first.left - last.left;
            const dy = first.top - last.top;
            card.style.transform = `translate(${dx}px, ${dy}px)`;
            card.style.transition = 'none';

            // PLAY
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                card.style.transition = 'transform 400ms cubic-bezier(0.22, 1, 0.36, 1)';
                card.style.transform = '';
                card.addEventListener('transitionend', () => {
                  card.style.transition = '';
                }, { once: true });
              });
            });
          });
        });
      })();

      // ================================================================
      //  5. DRAGGABLE CARDS
      // ================================================================
      (function() {
        const stage = document.getElementById('drag-stage');
        if (!stage) return;

        const cards = stage.querySelectorAll('.drag-card');
        cards.forEach(card => {
          let dragging = false;
          let startX, startY, cardX, cardY;
          let velX = 0, velY = 0, lastX = 0, lastY = 0, lastTime = 0;
          let inertiaId = null;

          card.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            dragging = true;
            card.setPointerCapture(e.pointerId);
            card.style.cursor = 'grabbing';
            card.style.zIndex = '10';
            const rect = card.getBoundingClientRect();
            const parentRect = stage.getBoundingClientRect();
            cardX = rect.left - parentRect.left;
            cardY = rect.top - parentRect.top;
            startX = e.clientX - cardX;
            startY = e.clientY - cardY;
            lastX = e.clientX; lastY = e.clientY;
            lastTime = performance.now();
            velX = 0; velY = 0;
            if (inertiaId) cancelAnimationFrame(inertiaId);
          });

          card.addEventListener('pointermove', (e) => {
            if (!dragging) return;
            const nx = e.clientX - startX;
            const ny = e.clientY - startY;
            card.style.left = nx + 'px';
            card.style.top = ny + 'px';

            const now = performance.now();
            const dt = (now - lastTime) / 1000;
            if (dt > 0) {
              velX = (e.clientX - lastX) / dt;
              velY = (e.clientY - lastY) / dt;
            }
            lastX = e.clientX; lastY = e.clientY; lastTime = now;
          });

          card.addEventListener('pointerup', () => {
            if (!dragging) return;
            dragging = false;
            card.style.cursor = 'grab';
            card.style.zIndex = '';

            // Inertia
            let ix = velX * 0.15;
            let iy = velY * 0.15;
            function inertia() {
              ix *= 0.92;
              iy *= 0.92;
              const cl = parseFloat(card.style.left) || 0;
              const ct = parseFloat(card.style.top) || 0;
              card.style.left = (cl + ix) + 'px';
              card.style.top = (ct + iy) + 'px';
              if (Math.abs(ix) > 0.5 || Math.abs(iy) > 0.5) {
                inertiaId = requestAnimationFrame(inertia);
              }
            }
            if (Math.abs(ix) > 1 || Math.abs(iy) > 1) inertia();
          });
        });
      })();

      // ================================================================
      //  6a. FLOW FIELD
      // ================================================================
      (function() {
        const canvas = document.getElementById('flowfield-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const particles = [];
        const COUNT = 300;
        let time = 0;

        // Simple Perlin-like noise using sin
        function noise(x, y, t) {
          return Math.sin(x * 0.02 + t * 0.3) * Math.cos(y * 0.02 - t * 0.2) +
                 Math.sin(x * 0.01 - y * 0.01 + t * 0.1) * 0.5;
        }

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          particles.length = 0;
          const palette = [colors.primary, colors.gold, colors.cyan, colors.green, colors.purple];
          for (let i = 0; i < COUNT; i++) {
            particles.push({
              x: Math.random() * w,
              y: Math.random() * h,
              color: palette[i % palette.length] + '40',
            });
          }
          ctx.fillStyle = colors.bgSubtle;
          ctx.fillRect(0, 0, w, h);
        }

        registerAnimation('flowfield', (dt) => {
          time += dt;
          ctx.fillStyle = colors.bgSubtle + '08';
          ctx.fillRect(0, 0, w, h);

          for (const p of particles) {
            const angle = noise(p.x, p.y, time) * Math.PI * 2;
            p.x += Math.cos(angle) * 1.5;
            p.y += Math.sin(angle) * 1.5;

            if (p.x < 0 || p.x > w || p.y < 0 || p.y > h) {
              p.x = Math.random() * w;
              p.y = Math.random() * h;
            }

            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 2, 2);
          }
        });

        observeCanvas(canvas.parentElement, 'flowfield', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  6b. FRACTAL TREE
      // ================================================================
      (function() {
        const canvas = document.getElementById('fractal-canvas');
        const regrowBtn = document.getElementById('fractal-regrow');
        if (!canvas) return;

        let ctx, w, h;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          drawTree();
        }

        function drawTree() {
          ctx.clearRect(0, 0, w, h);
          const startX = w / 2;
          const startY = h - 10;
          const palette = [colors.green, colors.cyan, colors.primary, colors.gold, colors.purple];

          function branch(x, y, angle, length, depth) {
            if (depth > 10 || length < 3) return;
            const endX = x + Math.cos(angle) * length;
            const endY = y + Math.sin(angle) * length;

            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = palette[Math.min(depth, palette.length - 1)];
            ctx.lineWidth = Math.max(1, 8 - depth);
            ctx.stroke();

            const spread = 0.4 + Math.random() * 0.3;
            const shrink = 0.65 + Math.random() * 0.15;
            branch(endX, endY, angle - spread, length * shrink, depth + 1);
            branch(endX, endY, angle + spread, length * shrink, depth + 1);
          }

          branch(startX, startY, -Math.PI / 2, Math.min(h / 4, 80), 0);
        }

        if (regrowBtn) regrowBtn.addEventListener('click', drawTree);

        observeCanvas(canvas.parentElement, 'fractal', init);
        registerAnimation('fractal', () => {});
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  7a. MAGNETIC BUTTONS
      // ================================================================
      (function() {
        const stage = document.getElementById('magnetic-stage');
        if (!stage) return;
        const buttons = stage.querySelectorAll('.magnetic-btn');

        stage.addEventListener('mousemove', (e) => {
          buttons.forEach(btn => {
            const rect = btn.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            const dx = e.clientX - cx;
            const dy = e.clientY - cy;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const threshold = 100;
            if (dist < threshold) {
              const pull = (threshold - dist) / threshold;
              btn.style.transform = `translate(${dx * pull * 0.4}px, ${dy * pull * 0.4}px)`;
            } else {
              btn.style.transform = '';
            }
          });
        });

        stage.addEventListener('mouseleave', () => {
          buttons.forEach(btn => { btn.style.transform = ''; });
        });
      })();

      // ================================================================
      //  7b. TILT CARDS
      // ================================================================
      (function() {
        document.querySelectorAll('.tilt-card').forEach(card => {
          card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width - 0.5;
            const y = (e.clientY - rect.top) / rect.height - 0.5;
            card.style.transform = `perspective(500px) rotateY(${x * 20}deg) rotateX(${-y * 20}deg)`;
            card.style.boxShadow = `${-x * 8}px ${y * 8}px 0 var(--border-default)`;
          });
          card.addEventListener('mouseleave', () => {
            card.style.transform = '';
            card.style.boxShadow = '';
          });
        });
      })();

      // ================================================================
      //  7c. RIPPLE EFFECT
      // ================================================================
      (function() {
        const stage = document.getElementById('ripple-stage');
        if (!stage) return;

        stage.addEventListener('click', (e) => {
          const rect = stage.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const ripple = document.createElement('div');
          ripple.style.cssText = `
            position:absolute;left:${x}px;top:${y}px;width:10px;height:10px;
            border-radius:50%;border:2px solid var(--accent-primary);
            transform:translate(-50%,-50%) scale(1);opacity:1;
            pointer-events:none;
          `;
          stage.appendChild(ripple);
          ripple.animate([
            { transform: 'translate(-50%,-50%) scale(1)', opacity: 1 },
            { transform: 'translate(-50%,-50%) scale(20)', opacity: 0 }
          ], { duration: 600, easing: 'cubic-bezier(0.16, 1, 0.3, 1)' }).onfinish = () => ripple.remove();
        });
      })();

      // ================================================================
      //  8a. SVG MORPH
      // ================================================================
      (function() {
        const path = document.getElementById('morph-path');
        const btn = document.getElementById('morph-toggle');
        if (!path || !btn) return;

        const shapes = [
          'M100,20 C140,20 180,60 180,100 C180,140 140,180 100,180 C60,180 20,140 20,100 C20,60 60,20 100,20 Z',
          'M100,10 L120,75 L190,75 L135,115 L155,180 L100,140 L45,180 L65,115 L10,75 L80,75 Z',
          'M30,30 L170,30 L170,170 L30,170 Z',
          'M100,20 C150,40 180,80 160,120 C140,160 110,180 80,160 C50,140 20,120 40,80 C60,40 80,20 100,20 Z',
        ];
        const colorList = ['var(--accent-primary)', 'var(--accent-gold)', 'var(--accent-cyan)', 'var(--accent-purple)'];
        let shapeIdx = 0;

        btn.addEventListener('click', () => {
          shapeIdx = (shapeIdx + 1) % shapes.length;
          path.style.transition = 'd 400ms cubic-bezier(0.22, 1, 0.36, 1), fill 400ms ease';
          path.setAttribute('d', shapes[shapeIdx]);
          path.setAttribute('fill', colorList[shapeIdx]);
        });
      })();

      // ================================================================
      //  8b. DRAWING ANIMATION
      // ================================================================
      (function() {
        const drawPath = document.getElementById('draw-path');
        const drawDot = document.getElementById('draw-dot');
        const drawBtn = document.getElementById('draw-play');
        if (!drawPath || !drawBtn) return;

        drawBtn.addEventListener('click', () => {
          const len = drawPath.getTotalLength();
          drawPath.style.strokeDasharray = len;
          drawPath.style.strokeDashoffset = len;
          drawPath.style.transition = 'none';
          if (drawDot) { drawDot.style.opacity = '1'; drawDot.style.transition = 'none'; }
          void drawPath.offsetWidth;

          drawPath.style.transition = `stroke-dashoffset 1.5s cubic-bezier(0.22, 1, 0.36, 1)`;
          drawPath.style.strokeDashoffset = '0';

          // Animate dot along path
          if (drawDot) {
            const start = performance.now();
            const duration = 1500;
            function moveDot(now) {
              const t = Math.min((now - start) / duration, 1);
              const eased = 1 - Math.pow(1 - t, 3);
              const pt = drawPath.getPointAtLength(eased * len);
              drawDot.setAttribute('cx', pt.x);
              drawDot.setAttribute('cy', pt.y);
              if (t < 1) requestAnimationFrame(moveDot);
            }
            requestAnimationFrame(moveDot);
          }
        });
      })();

      // ================================================================
      //  8c. GOOEY BUTTON
      // ================================================================
      (function() {
        const main = document.getElementById('gooey-main');
        const blob1 = document.getElementById('gooey-blob-1');
        const blob2 = document.getElementById('gooey-blob-2');
        if (!main || !blob1 || !blob2) return;

        main.addEventListener('mouseenter', () => {
          blob1.style.transition = 'transform 0.4s ease, opacity 0.2s ease';
          blob2.style.transition = 'transform 0.5s ease 0.05s, opacity 0.2s ease';
          blob1.style.opacity = '1';
          blob2.style.opacity = '1';
          blob1.style.transform = 'translate(-30px, -20px)';
          blob2.style.transform = 'translate(30px, -18px)';
        });
        main.addEventListener('mouseleave', () => {
          blob1.style.transition = 'transform 0.3s ease, opacity 0.3s ease 0.1s';
          blob2.style.transition = 'transform 0.3s ease, opacity 0.3s ease 0.1s';
          blob1.style.transform = '';
          blob2.style.transform = '';
          blob1.style.opacity = '0';
          blob2.style.opacity = '0';
        });
      })();

      // ================================================================
      //  9a. EMOJI RAIN
      // ================================================================
      (function() {
        const canvas = document.getElementById('emoji-canvas');
        const startBtn = document.getElementById('emoji-start');
        if (!canvas) return;

        let ctx, w, h;
        const emojis = [];
        const emojiChars = ['🎉', '✨', '🌟', '💖', '🔥', '🎨', '🌈', '💫', '🎪', '🦄'];

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          emojis.length = 0;
        }

        function spawnBatch() {
          for (let i = 0; i < 20; i++) {
            emojis.push({
              x: Math.random() * w,
              y: -30 - Math.random() * 100,
              vy: 40 + Math.random() * 80,
              vx: (Math.random() - 0.5) * 30,
              size: 16 + Math.random() * 20,
              char: emojiChars[Math.floor(Math.random() * emojiChars.length)],
              rotation: Math.random() * Math.PI * 2,
              rotSpeed: (Math.random() - 0.5) * 3,
            });
          }
          activateAnimation('emoji');
        }

        if (startBtn) startBtn.addEventListener('click', (e) => { e.stopPropagation(); spawnBatch(); });
        canvas.addEventListener('click', spawnBatch);

        registerAnimation('emoji', (dt) => {
          ctx.clearRect(0, 0, w, h);
          for (let i = emojis.length - 1; i >= 0; i--) {
            const e = emojis[i];
            e.y += e.vy * dt;
            e.x += e.vx * dt;
            e.vx += Math.sin(e.y * 0.02) * dt * 10;
            e.rotation += e.rotSpeed * dt;

            if (e.y > h + 40) { emojis.splice(i, 1); continue; }

            ctx.save();
            ctx.translate(e.x, e.y);
            ctx.rotate(e.rotation);
            ctx.font = `${e.size}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(e.char, 0, 0);
            ctx.restore();
          }
          if (emojis.length === 0) deactivateAnimation('emoji');
        });

        observeCanvas(canvas.parentElement, 'emoji', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  9b. MATRIX RAIN
      // ================================================================
      (function() {
        const canvas = document.getElementById('matrix-canvas');
        if (!canvas) return;

        let ctx, w, h;
        const columns = [];
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%^&*()';
        const fontSize = 14;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          columns.length = 0;
          const colCount = Math.floor(w / fontSize);
          for (let i = 0; i < colCount; i++) {
            columns.push(Math.random() * h / fontSize);
          }
        }

        registerAnimation('matrix', (dt) => {
          ctx.fillStyle = 'rgba(20, 20, 20, 0.05)';
          ctx.fillRect(0, 0, w, h);
          ctx.font = `${fontSize}px JetBrains Mono, monospace`;

          for (let i = 0; i < columns.length; i++) {
            const char = chars[Math.floor(Math.random() * chars.length)];
            const x = i * fontSize;
            const y = columns[i] * fontSize;

            ctx.fillStyle = colors.green;
            ctx.globalAlpha = 0.9;
            ctx.fillText(char, x, y);
            ctx.globalAlpha = 1;

            if (y > h && Math.random() > 0.975) {
              columns[i] = 0;
            }
            columns[i] += 0.5;
          }
        });

        observeCanvas(canvas.parentElement, 'matrix', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  9c. AURORA GRADIENT
      // ================================================================
      (function() {
        const canvas = document.getElementById('aurora-canvas');
        if (!canvas) return;

        let ctx, w, h;
        let time = 0;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
        }

        registerAnimation('aurora', (dt) => {
          time += dt * 0.5;
          ctx.clearRect(0, 0, w, h);

          const palette = [
            { color: colors.primary, x: w * (0.3 + Math.sin(time * 0.7) * 0.2), y: h * (0.3 + Math.cos(time * 0.5) * 0.2) },
            { color: colors.gold, x: w * (0.7 + Math.cos(time * 0.6) * 0.2), y: h * (0.4 + Math.sin(time * 0.4) * 0.2) },
            { color: colors.cyan, x: w * (0.5 + Math.sin(time * 0.8) * 0.3), y: h * (0.7 + Math.cos(time * 0.3) * 0.2) },
            { color: colors.purple, x: w * (0.2 + Math.cos(time * 0.5) * 0.15), y: h * (0.6 + Math.sin(time * 0.6) * 0.15) },
          ];

          for (const blob of palette) {
            const grad = ctx.createRadialGradient(blob.x, blob.y, 0, blob.x, blob.y, w * 0.4);
            grad.addColorStop(0, blob.color + '60');
            grad.addColorStop(1, blob.color + '00');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, w, h);
          }
        });

        observeCanvas(canvas.parentElement, 'aurora', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

      // ================================================================
      //  10. COMBINED: SPRING + CONFETTI
      // ================================================================
      (function() {
        const canvas = document.getElementById('combo-canvas');
        const btn = document.getElementById('combo-btn');
        if (!canvas || !btn) return;

        let ctx, w, h;
        const comboParticles = [];
        const POOL = 150;
        const btnState = { value: 1, velocity: 0, target: 1 };
        let pressing = false;

        function init() {
          ({ ctx, w, h } = setupCanvas(canvas));
          comboParticles.length = 0;
          for (let i = 0; i < POOL; i++) {
            comboParticles.push({ active: false, x: 0, y: 0, vx: 0, vy: 0, life: 0, maxLife: 0, color: '', r: 0, rotation: 0, rotSpeed: 0, shape: 0 });
          }
        }

        function emitCombo() {
          const palette = [colors.primary, colors.gold, colors.cyan, colors.danger, colors.green, colors.purple];
          const cx = w / 2, cy = h / 2;
          let count = 0;
          for (const p of comboParticles) {
            if (p.active || count >= 60) continue;
            p.active = true;
            p.x = cx; p.y = cy;
            const angle = -Math.PI / 2 + (Math.random() - 0.5) * Math.PI;
            const speed = 200 + Math.random() * 400;
            p.vx = Math.cos(angle) * speed;
            p.vy = Math.sin(angle) * speed;
            p.r = 3 + Math.random() * 5;
            p.color = palette[Math.floor(Math.random() * palette.length)];
            p.life = 0; p.maxLife = 1 + Math.random() * 1.5;
            p.rotation = Math.random() * Math.PI * 2;
            p.rotSpeed = (Math.random() - 0.5) * 10;
            p.shape = Math.floor(Math.random() * 3);
            count++;
          }
        }

        btn.addEventListener('pointerdown', () => {
          pressing = true;
          btnState.target = 0.88;
          activateAnimation('combo');
        });
        btn.addEventListener('pointerup', () => {
          pressing = false;
          btnState.target = 1;
          emitCombo();
          activateAnimation('combo');
        });
        btn.addEventListener('pointerleave', () => {
          if (pressing) { pressing = false; btnState.target = 1; }
        });

        registerAnimation('combo', (dt) => {
          springStep(btnState, { stiffness: 300, damping: 15, mass: 1 }, dt);
          btn.style.transform = `translate(-50%, -50%) scale(${btnState.value})`;

          ctx.clearRect(0, 0, w, h);
          let active = 0;
          for (const p of comboParticles) {
            if (!p.active) continue;
            p.life += dt;
            if (p.life > p.maxLife) { p.active = false; continue; }
            active++;
            p.vy += 400 * dt;
            p.vx *= 0.99;
            p.x += p.vx * dt;
            p.y += p.vy * dt;
            p.rotation += p.rotSpeed * dt;
            const alpha = 1 - p.life / p.maxLife;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation);
            ctx.globalAlpha = alpha;
            ctx.fillStyle = p.color;
            if (p.shape === 0) ctx.fillRect(-p.r, -p.r / 3, p.r * 2, p.r * 0.66);
            else if (p.shape === 1) { ctx.beginPath(); ctx.arc(0, 0, p.r / 2, 0, Math.PI * 2); ctx.fill(); }
            else { ctx.beginPath(); ctx.moveTo(0, -p.r); ctx.lineTo(p.r * 0.7, p.r * 0.5); ctx.lineTo(-p.r * 0.7, p.r * 0.5); ctx.fill(); }
            ctx.restore();
          }

          if (active === 0 && !pressing && Math.abs(btnState.value - 1) < 0.001) {
            deactivateAnimation('combo');
          }
        });

        observeCanvas(canvas.parentElement, 'combo', init);
        window.addEventListener('resize', () => { if (ctx) init(); });
      })();

    })();
  </script>
</body>
</html>
